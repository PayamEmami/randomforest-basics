<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Decision trees | Classification and Regression by RandomForest</title>
  <meta name="description" content="This is a short tutorial on how RandomForest works" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Decision trees | Classification and Regression by RandomForest" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a short tutorial on how RandomForest works" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Decision trees | Classification and Regression by RandomForest" />
  
  <meta name="twitter:description" content="This is a short tutorial on how RandomForest works" />
  

<meta name="author" content="Payam Emami" />


<meta name="date" content="2021-09-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="bagging.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Random Forests</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="dectr.html"><a href="dectr.html"><i class="fa fa-check"></i><b>3</b> Decision trees</a><ul>
<li class="chapter" data-level="3.1" data-path="dectr.html"><a href="dectr.html#intuition"><i class="fa fa-check"></i><b>3.1</b> Intuition</a></li>
<li class="chapter" data-level="3.2" data-path="dectr.html"><a href="dectr.html#classification"><i class="fa fa-check"></i><b>3.2</b> Classification</a><ul>
<li class="chapter" data-level="3.2.1" data-path="dectr.html"><a href="dectr.html#gini-index-gini-impurity-and-gini-gain"><i class="fa fa-check"></i><b>3.2.1</b> Gini index, Gini impurity and Gini gain</a></li>
<li class="chapter" data-level="3.2.2" data-path="dectr.html"><a href="dectr.html#entropy-and-information-gain"><i class="fa fa-check"></i><b>3.2.2</b> Entropy and information gain</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="dectr.html"><a href="dectr.html#regression"><i class="fa fa-check"></i><b>3.3</b> Regression</a></li>
<li class="chapter" data-level="3.4" data-path="dectr.html"><a href="dectr.html#pre-pruning"><i class="fa fa-check"></i><b>3.4</b> Pre-pruning</a></li>
<li class="chapter" data-level="3.5" data-path="dectr.html"><a href="dectr.html#post-pruning"><i class="fa fa-check"></i><b>3.5</b> Post-pruning</a></li>
<li class="chapter" data-level="3.6" data-path="dectr.html"><a href="dectr.html#cross-validation"><i class="fa fa-check"></i><b>3.6</b> Cross validation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bagging.html"><a href="bagging.html"><i class="fa fa-check"></i><b>4</b> Bagging</a><ul>
<li class="chapter" data-level="4.1" data-path="bagging.html"><a href="bagging.html#bias-variance"><i class="fa fa-check"></i><b>4.1</b> Bias-variance</a></li>
<li class="chapter" data-level="4.2" data-path="bagging.html"><a href="bagging.html#bootstrap-aggregating"><i class="fa fa-check"></i><b>4.2</b> Bootstrap aggregating</a></li>
<li class="chapter" data-level="4.3" data-path="bagging.html"><a href="bagging.html#out-of-bag-error"><i class="fa fa-check"></i><b>4.3</b> Out-Of-Bag error</a></li>
<li class="chapter" data-level="4.4" data-path="bagging.html"><a href="bagging.html#application"><i class="fa fa-check"></i><b>4.4</b> Application</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="random-forest.html"><a href="random-forest.html"><i class="fa fa-check"></i><b>5</b> Random forest</a><ul>
<li class="chapter" data-level="5.1" data-path="random-forest.html"><a href="random-forest.html#tuning-parameters-for-random-forests"><i class="fa fa-check"></i><b>5.1</b> Tuning parameters for random forests</a></li>
<li class="chapter" data-level="5.2" data-path="random-forest.html"><a href="random-forest.html#variable-importance"><i class="fa fa-check"></i><b>5.2</b> Variable importance</a><ul>
<li class="chapter" data-level="5.2.1" data-path="random-forest.html"><a href="random-forest.html#feature-importance-by-permutation"><i class="fa fa-check"></i><b>5.2.1</b> Feature importance by permutation</a></li>
<li class="chapter" data-level="5.2.2" data-path="random-forest.html"><a href="random-forest.html#feature-importance-by-impurity"><i class="fa fa-check"></i><b>5.2.2</b> Feature importance by impurity</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="random-forest.html"><a href="random-forest.html#how-to-use-random-forest-in-r"><i class="fa fa-check"></i><b>5.3</b> How to use random forest in R</a><ul>
<li class="chapter" data-level="5.3.1" data-path="random-forest.html"><a href="random-forest.html#data"><i class="fa fa-check"></i><b>5.3.1</b> Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>6</b> Summary</a></li>
<li class="divider"></li>
<li>Payam Emami ( <li><a href="https://www.nbis.se/">National Bioinformatics Infrastructure Sweden</a></li>)</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Classification and Regression by RandomForest</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dectr" class="section level1">
<h1><span class="header-section-number">3</span> Decision trees</h1>
<p>Decision tree modelling is one of the most intuitive and easy to understand modelling techniques used in statistics. They have minimum requirements for data pre-processing, little assumption about the data distribution, missing value handling and many other benefits.</p>
<p>Let first have a look at some terminology:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="dectr.html#cb3-1"></a><span class="kw">library</span>(DiagrammeR)</span>
<span id="cb3-2"><a href="dectr.html#cb3-2"></a></span>
<span id="cb3-3"><a href="dectr.html#cb3-3"></a>nodes &lt;-<span class="st"> </span><span class="kw">create_node_df</span>(<span class="dt">n =</span> <span class="dv">9</span>, <span class="dt">type =</span> <span class="st">&quot;number&quot;</span>,<span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>,<span class="st">&quot;E&quot;</span>,<span class="st">&quot;F&quot;</span>,<span class="st">&quot;G&quot;</span>,<span class="st">&quot;H&quot;</span>,<span class="st">&quot;I&quot;</span>))</span>
<span id="cb3-4"><a href="dectr.html#cb3-4"></a></span>
<span id="cb3-5"><a href="dectr.html#cb3-5"></a>edges &lt;-<span class="st"> </span><span class="kw">create_edge_df</span>(<span class="dt">from =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">6</span>),</span>
<span id="cb3-6"><a href="dectr.html#cb3-6"></a>                        <span class="dt">to =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),</span>
<span id="cb3-7"><a href="dectr.html#cb3-7"></a>                       <span class="dt">rel =</span> <span class="st">&quot;leading to&quot;</span>)</span>
<span id="cb3-8"><a href="dectr.html#cb3-8"></a></span>
<span id="cb3-9"><a href="dectr.html#cb3-9"></a>graph &lt;-<span class="st"> </span><span class="kw">create_graph</span>(<span class="dt">nodes_df =</span> nodes, <span class="dt">attr_theme =</span> <span class="st">&quot;tb&quot;</span>,</span>
<span id="cb3-10"><a href="dectr.html#cb3-10"></a>                      <span class="dt">edges_df =</span> edges, </span>
<span id="cb3-11"><a href="dectr.html#cb3-11"></a>                  ) </span>
<span id="cb3-12"><a href="dectr.html#cb3-12"></a></span>
<span id="cb3-13"><a href="dectr.html#cb3-13"></a><span class="kw">render_graph</span>(graph)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-termin"></span>
<div id="htmlwidget-939ee43f63bf9d70cce1" style="width:480px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-939ee43f63bf9d70cce1">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       rankdir = \"TB\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"A\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"B\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"C\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"D\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"E\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"F\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"G\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"8\" [label = \"H\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"9\" [label = \"I\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n  \"2\"->\"4\" \n  \"2\"->\"5\" \n  \"3\"->\"6\" \n  \"3\"->\"7\" \n  \"6\"->\"8\" \n  \"6\"->\"9\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.1: The example of an imaginary decision tree
</p>
</div>
<p>Each circle is a called a node and each line is called an edge. The very first node in top of the tree is called a root node (A). Nodes that are not root but are have out going connections are called child node (B,C,F). The nodes at the bottom of the tree are called leaf nodes or terminal nodes. We tend to say that node B is child of node A because there is incoming connection from A to B. The same applies to C. Similarly, we say A is the parent of B and C. The same naming applies throughout the tree. For example H is a leaf node that is the child of F. Finally, we sometime say that A has been split to B and C which obviously means it has two child nodes. That was it. Let’s continue to see what trees are!</p>
<div id="intuition" class="section level2">
<h2><span class="header-section-number">3.1</span> Intuition</h2>
<p>Decision trees are normally built through sequentially segmenting the data using simple rules until reaching some criteria for stooping. Let’s try to develop an intuition about them using our dataset. Here we focus on classification and later extend it to the regression.</p>
<p>In Figure <a href="#fig:groups1"><strong>??</strong></a>, we have plotted our AD data (only AD and controls). On the <span class="math inline">\(x\)</span> axis we have <span class="math inline">\(A\beta\)</span> and on the <span class="math inline">\(y\)</span> axis we have t tau.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="dectr.html#cb4-1"></a><span class="co"># Select variable</span></span>
<span id="cb4-2"><a href="dectr.html#cb4-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb4-3"><a href="dectr.html#cb4-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb4-4"><a href="dectr.html#cb4-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb4-5"><a href="dectr.html#cb4-5"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb4-6"><a href="dectr.html#cb4-6"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb4-7"><a href="dectr.html#cb4-7"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="dt">legend =</span> <span class="kw">paste</span>(<span class="st">&quot;Group&quot;</span>,<span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))),</span>
<span id="cb4-8"><a href="dectr.html#cb4-8"></a>       <span class="dt">col=</span><span class="kw">as.factor</span>(<span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))),</span>
<span id="cb4-9"><a href="dectr.html#cb4-9"></a>       <span class="dt">pch=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups1"></span>
<img src="_main_files/figure-html/fig-groups1-1.png" alt="The example of two variables measured on a number of samples." width="672" />
<p class="caption">
Figure 3.2: The example of two variables measured on a number of samples.
</p>
</div>
<p>Now we want to cut our data based on our variables into AD and controls and we are only allowed to draw a single vertical (<span class="math inline">\(x\)</span> axis) or horizontal (<span class="math inline">\(y\)</span> axis) line. Maybe we can draw a line like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="dectr.html#cb5-1"></a><span class="co"># Select variable</span></span>
<span id="cb5-2"><a href="dectr.html#cb5-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb5-3"><a href="dectr.html#cb5-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb5-4"><a href="dectr.html#cb5-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb5-5"><a href="dectr.html#cb5-5"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb5-6"><a href="dectr.html#cb5-6"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb5-7"><a href="dectr.html#cb5-7"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="dt">legend =</span> <span class="kw">paste</span>(<span class="st">&quot;Group&quot;</span>,<span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))),</span>
<span id="cb5-8"><a href="dectr.html#cb5-8"></a>       <span class="dt">col=</span><span class="kw">as.factor</span>(<span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))),</span>
<span id="cb5-9"><a href="dectr.html#cb5-9"></a>       <span class="dt">pch=</span><span class="dv">1</span>)</span>
<span id="cb5-10"><a href="dectr.html#cb5-10"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">250</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups2"></span>
<img src="_main_files/figure-html/fig-groups2-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=250" width="672" />
<p class="caption">
Figure 3.3: The example of two variables measured on a number of samples. Cut on abeta=250
</p>
</div>
<p>Well! That is OK we have only AD patients on the left side of the red line but on the right side we have a huge mix of AD and controls. Maybe we could do a bit better. Let’s put the line a bit further.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="dectr.html#cb6-1"></a><span class="co"># Select variable</span></span>
<span id="cb6-2"><a href="dectr.html#cb6-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb6-3"><a href="dectr.html#cb6-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb6-4"><a href="dectr.html#cb6-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb6-5"><a href="dectr.html#cb6-5"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb6-6"><a href="dectr.html#cb6-6"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb6-7"><a href="dectr.html#cb6-7"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="dt">legend =</span> <span class="kw">paste</span>(<span class="st">&quot;Group&quot;</span>,<span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))),</span>
<span id="cb6-8"><a href="dectr.html#cb6-8"></a>       <span class="dt">col=</span><span class="kw">as.factor</span>(<span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))),</span>
<span id="cb6-9"><a href="dectr.html#cb6-9"></a>       <span class="dt">pch=</span><span class="dv">1</span>)</span>
<span id="cb6-10"><a href="dectr.html#cb6-10"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">610</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups3"></span>
<img src="_main_files/figure-html/fig-groups3-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610" width="672" />
<p class="caption">
Figure 3.4: The example of two variables measured on a number of samples. Cut on abeta=610
</p>
</div>
<p>That is much better. Let’s try to separate the data on the left and right sides of the line into two plots.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="dectr.html#cb7-1"></a><span class="co"># Select variable</span></span>
<span id="cb7-2"><a href="dectr.html#cb7-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb7-3"><a href="dectr.html#cb7-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb7-4"><a href="dectr.html#cb7-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb7-5"><a href="dectr.html#cb7-5"></a></span>
<span id="cb7-6"><a href="dectr.html#cb7-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb7-7"><a href="dectr.html#cb7-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb7-8"><a href="dectr.html#cb7-8"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">3</span>), <span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb7-9"><a href="dectr.html#cb7-9"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb7-10"><a href="dectr.html#cb7-10"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb7-11"><a href="dectr.html#cb7-11"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb7-12"><a href="dectr.html#cb7-12"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb7-13"><a href="dectr.html#cb7-13"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">610</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb7-14"><a href="dectr.html#cb7-14"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb7-15"><a href="dectr.html#cb7-15"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb7-16"><a href="dectr.html#cb7-16"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb7-17"><a href="dectr.html#cb7-17"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb7-18"><a href="dectr.html#cb7-18"></a></span>
<span id="cb7-19"><a href="dectr.html#cb7-19"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb7-20"><a href="dectr.html#cb7-20"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=610&quot;</span>)</span>
<span id="cb7-21"><a href="dectr.html#cb7-21"></a></span>
<span id="cb7-22"><a href="dectr.html#cb7-22"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb7-23"><a href="dectr.html#cb7-23"></a></span>
<span id="cb7-24"><a href="dectr.html#cb7-24"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb7-25"><a href="dectr.html#cb7-25"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb7-26"><a href="dectr.html#cb7-26"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb7-27"><a href="dectr.html#cb7-27"></a></span>
<span id="cb7-28"><a href="dectr.html#cb7-28"></a></span>
<span id="cb7-29"><a href="dectr.html#cb7-29"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb7-30"><a href="dectr.html#cb7-30"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb7-31"><a href="dectr.html#cb7-31"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups4"></span>
<img src="_main_files/figure-html/fig-groups4-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610. The top plot shows all the data. The left figure shows the data points where abeta is &lt;610 and the right plot shows the data points with abeta &gt;=610" width="672" />
<p class="caption">
Figure 3.5: The example of two variables measured on a number of samples. Cut on abeta=610. The top plot shows all the data. The left figure shows the data points where abeta is &lt;610 and the right plot shows the data points with abeta &gt;=610
</p>
</div>
<p>We can see in Figure <a href="dectr.html#fig:fig-groups4">3.5</a> that both plots are a bit “cleaner” than the original plot with respect to the group distribution. This is probably a bit more clear if we look at the distribution of different groups.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="dectr.html#cb8-1"></a><span class="co"># Select variable</span></span>
<span id="cb8-2"><a href="dectr.html#cb8-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb8-3"><a href="dectr.html#cb8-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb8-4"><a href="dectr.html#cb8-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb8-5"><a href="dectr.html#cb8-5"></a></span>
<span id="cb8-6"><a href="dectr.html#cb8-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb8-7"><a href="dectr.html#cb8-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb8-8"><a href="dectr.html#cb8-8"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">3</span>), <span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb8-9"><a href="dectr.html#cb8-9"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb8-10"><a href="dectr.html#cb8-10"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb8-11"><a href="dectr.html#cb8-11"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb8-12"><a href="dectr.html#cb8-12"></a></span>
<span id="cb8-13"><a href="dectr.html#cb8-13"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group)),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>,<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb8-14"><a href="dectr.html#cb8-14"></a></span>
<span id="cb8-15"><a href="dectr.html#cb8-15"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb8-16"><a href="dectr.html#cb8-16"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb8-17"><a href="dectr.html#cb8-17"></a></span>
<span id="cb8-18"><a href="dectr.html#cb8-18"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group)),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>,<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb8-19"><a href="dectr.html#cb8-19"></a></span>
<span id="cb8-20"><a href="dectr.html#cb8-20"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb8-21"><a href="dectr.html#cb8-21"></a></span>
<span id="cb8-22"><a href="dectr.html#cb8-22"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.1</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb8-23"><a href="dectr.html#cb8-23"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb8-24"><a href="dectr.html#cb8-24"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb8-25"><a href="dectr.html#cb8-25"></a></span>
<span id="cb8-26"><a href="dectr.html#cb8-26"></a></span>
<span id="cb8-27"><a href="dectr.html#cb8-27"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.1</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb8-28"><a href="dectr.html#cb8-28"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb8-29"><a href="dectr.html#cb8-29"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups5"></span>
<img src="_main_files/figure-html/fig-groups5-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610. The top plot shows all the data. The left figure shows the data points where abeta is &lt;610 and the right plot shows the data points with abeta &gt;=610" width="672" />
<p class="caption">
Figure 3.6: The example of two variables measured on a number of samples. Cut on abeta=610. The top plot shows all the data. The left figure shows the data points where abeta is &lt;610 and the right plot shows the data points with abeta &gt;=610
</p>
</div>
<p>So we can conclude that the data is a bit cleaner or purer with respect to the group distribution. That is great. What we can do now? We can either say, that is good enough! Or we can continue with each of the segments. Let’s continue and do one more round of segmentation. We start with the data points where <span class="math inline">\(A\beta&lt;610\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="dectr.html#cb9-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb9-2"><a href="dectr.html#cb9-2"></a></span>
<span id="cb9-3"><a href="dectr.html#cb9-3"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb9-4"><a href="dectr.html#cb9-4"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups6"></span>
<img src="_main_files/figure-html/fig-groups6-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta&lt;610." width="672" />
<p class="caption">
Figure 3.7: The example of two variables measured on a number of samples. Cut on abeta&lt;610.
</p>
</div>
<p>That does not look so easy. Let’s instead look at the distribution of each of the variables alone and decide</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="dectr.html#cb10-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb10-2"><a href="dectr.html#cb10-2"></a></span>
<span id="cb10-3"><a href="dectr.html#cb10-3"></a>d &lt;-<span class="st"> </span><span class="kw">density</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span> <span class="op">&amp;</span><span class="st"> </span>limited_data<span class="op">$</span>group<span class="op">==</span><span class="st">&quot;control&quot;</span>,variableIndex])</span>
<span id="cb10-4"><a href="dectr.html#cb10-4"></a>d2&lt;-<span class="kw">density</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span> <span class="op">&amp;</span><span class="st"> </span>limited_data<span class="op">$</span>group<span class="op">==</span><span class="st">&quot;AD&quot;</span>,variableIndex])</span>
<span id="cb10-5"><a href="dectr.html#cb10-5"></a><span class="kw">plot</span>(d, <span class="dt">main=</span><span class="st">&quot;Kernel Density of abeta&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;abeta&quot;</span>)</span>
<span id="cb10-6"><a href="dectr.html#cb10-6"></a><span class="kw">lines</span>(d2)</span>
<span id="cb10-7"><a href="dectr.html#cb10-7"></a><span class="kw">polygon</span>(d, <span class="dt">col=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.5</span>))</span>
<span id="cb10-8"><a href="dectr.html#cb10-8"></a><span class="kw">polygon</span>(d2, <span class="dt">col=</span><span class="kw">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb10-9"><a href="dectr.html#cb10-9"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;AD&quot;</span>,<span class="st">&quot;Control&quot;</span>),<span class="dt">fill =</span> <span class="kw">c</span>(<span class="kw">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)))</span>
<span id="cb10-10"><a href="dectr.html#cb10-10"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">480</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb10-11"><a href="dectr.html#cb10-11"></a></span>
<span id="cb10-12"><a href="dectr.html#cb10-12"></a>d &lt;-<span class="st"> </span><span class="kw">density</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span> <span class="op">&amp;</span><span class="st"> </span>limited_data<span class="op">$</span>group<span class="op">==</span><span class="st">&quot;control&quot;</span>,variableIndex2])</span>
<span id="cb10-13"><a href="dectr.html#cb10-13"></a>d2&lt;-<span class="kw">density</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span> <span class="op">&amp;</span><span class="st"> </span>limited_data<span class="op">$</span>group<span class="op">==</span><span class="st">&quot;AD&quot;</span>,variableIndex2])</span>
<span id="cb10-14"><a href="dectr.html#cb10-14"></a><span class="kw">plot</span>(d, <span class="dt">main=</span><span class="st">&quot;Kernel Density of t tau&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;t-tau&quot;</span>)</span>
<span id="cb10-15"><a href="dectr.html#cb10-15"></a><span class="kw">lines</span>(d2)</span>
<span id="cb10-16"><a href="dectr.html#cb10-16"></a><span class="kw">polygon</span>(d, <span class="dt">col=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.5</span>))</span>
<span id="cb10-17"><a href="dectr.html#cb10-17"></a><span class="kw">polygon</span>(d2, <span class="dt">col=</span><span class="kw">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.5</span>))</span>
<span id="cb10-18"><a href="dectr.html#cb10-18"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;AD&quot;</span>,<span class="st">&quot;Control&quot;</span>),<span class="dt">fill =</span> <span class="kw">c</span>(<span class="kw">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.5</span>),<span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.5</span>)))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups7"></span>
<img src="_main_files/figure-html/fig-groups7-1.png" alt="Distribution of abeta and t tau for data points with abeta&lt;610." width="672" />
<p class="caption">
Figure 3.8: Distribution of abeta and t tau for data points with abeta&lt;610.
</p>
</div>
<p>honestly, it’s difficult to separate AD from control in t-tau but we might have a shot in <span class="math inline">\(A\beta\)</span>. Somewhere around 480 close to the peak of control (the green line) might give us a reasonable segment. This will separate our data like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="dectr.html#cb11-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb11-2"><a href="dectr.html#cb11-2"></a></span>
<span id="cb11-3"><a href="dectr.html#cb11-3"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb11-4"><a href="dectr.html#cb11-4"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb11-5"><a href="dectr.html#cb11-5"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">480</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups8"></span>
<img src="_main_files/figure-html/fig-groups8-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta&lt;480." width="672" />
<p class="caption">
Figure 3.9: The example of two variables measured on a number of samples. Cut on abeta&lt;480.
</p>
</div>
<p>Now let’s look at the previous segments together and see where we are:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="dectr.html#cb12-1"></a><span class="co"># Select variable</span></span>
<span id="cb12-2"><a href="dectr.html#cb12-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb12-3"><a href="dectr.html#cb12-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb12-4"><a href="dectr.html#cb12-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb12-5"><a href="dectr.html#cb12-5"></a></span>
<span id="cb12-6"><a href="dectr.html#cb12-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb12-7"><a href="dectr.html#cb12-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb12-8"><a href="dectr.html#cb12-8"></a></span>
<span id="cb12-9"><a href="dectr.html#cb12-9"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb12-10"><a href="dectr.html#cb12-10"></a>                <span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,</span>
<span id="cb12-11"><a href="dectr.html#cb12-11"></a>                <span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">0</span>,<span class="dv">7</span>), <span class="dv">3</span>, <span class="dv">7</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb12-12"><a href="dectr.html#cb12-12"></a></span>
<span id="cb12-13"><a href="dectr.html#cb12-13"></a>limited_data2&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]</span>
<span id="cb12-14"><a href="dectr.html#cb12-14"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb12-15"><a href="dectr.html#cb12-15"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb12-16"><a href="dectr.html#cb12-16"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb12-17"><a href="dectr.html#cb12-17"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb12-18"><a href="dectr.html#cb12-18"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">610</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb12-19"><a href="dectr.html#cb12-19"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb12-20"><a href="dectr.html#cb12-20"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb12-21"><a href="dectr.html#cb12-21"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb12-22"><a href="dectr.html#cb12-22"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb12-23"><a href="dectr.html#cb12-23"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">480</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb12-24"><a href="dectr.html#cb12-24"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb12-25"><a href="dectr.html#cb12-25"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=610&quot;</span>)</span>
<span id="cb12-26"><a href="dectr.html#cb12-26"></a></span>
<span id="cb12-27"><a href="dectr.html#cb12-27"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb12-28"><a href="dectr.html#cb12-28"></a></span>
<span id="cb12-29"><a href="dectr.html#cb12-29"></a></span>
<span id="cb12-30"><a href="dectr.html#cb12-30"></a></span>
<span id="cb12-31"><a href="dectr.html#cb12-31"></a><span class="kw">plot</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,variableIndex],limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb12-32"><a href="dectr.html#cb12-32"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;480&quot;</span>)</span>
<span id="cb12-33"><a href="dectr.html#cb12-33"></a></span>
<span id="cb12-34"><a href="dectr.html#cb12-34"></a>vps4 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb12-35"><a href="dectr.html#cb12-35"></a></span>
<span id="cb12-36"><a href="dectr.html#cb12-36"></a></span>
<span id="cb12-37"><a href="dectr.html#cb12-37"></a><span class="kw">plot</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,variableIndex],limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb12-38"><a href="dectr.html#cb12-38"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=480&quot;</span>)</span>
<span id="cb12-39"><a href="dectr.html#cb12-39"></a></span>
<span id="cb12-40"><a href="dectr.html#cb12-40"></a>vps5 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb12-41"><a href="dectr.html#cb12-41"></a></span>
<span id="cb12-42"><a href="dectr.html#cb12-42"></a></span>
<span id="cb12-43"><a href="dectr.html#cb12-43"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb12-44"><a href="dectr.html#cb12-44"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb12-45"><a href="dectr.html#cb12-45"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb12-46"><a href="dectr.html#cb12-46"></a></span>
<span id="cb12-47"><a href="dectr.html#cb12-47"></a></span>
<span id="cb12-48"><a href="dectr.html#cb12-48"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb12-49"><a href="dectr.html#cb12-49"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb12-50"><a href="dectr.html#cb12-50"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb12-51"><a href="dectr.html#cb12-51"></a></span>
<span id="cb12-52"><a href="dectr.html#cb12-52"></a></span>
<span id="cb12-53"><a href="dectr.html#cb12-53"></a></span>
<span id="cb12-54"><a href="dectr.html#cb12-54"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb12-55"><a href="dectr.html#cb12-55"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps4, </span>
<span id="cb12-56"><a href="dectr.html#cb12-56"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb12-57"><a href="dectr.html#cb12-57"></a></span>
<span id="cb12-58"><a href="dectr.html#cb12-58"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb12-59"><a href="dectr.html#cb12-59"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps5, </span>
<span id="cb12-60"><a href="dectr.html#cb12-60"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups9"></span>
<img src="_main_files/figure-html/fig-groups9-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480." width="1440" />
<p class="caption">
Figure 3.10: The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480.
</p>
</div>
<p>If we read Figure <a href="dectr.html#fig:fig-groups9">3.10</a> from top to bottom, we first started with all the data, we then segment the data based on abeta=610, giving us two segments of the original data. We then took the left segment (abeta&lt;610) and did another round of segmentation giving us two more subgroups of the data.</p>
<p>We can now continue with the right subgroup (abeta&gt;=610) similar to the left subgroup. This subgroup looks quite clean already but we can probably make it slightly better but putting a cutoff on t-tau. This time we place our segmentation line on 475.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="dectr.html#cb13-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb13-2"><a href="dectr.html#cb13-2"></a></span>
<span id="cb13-3"><a href="dectr.html#cb13-3"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb13-4"><a href="dectr.html#cb13-4"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb13-5"><a href="dectr.html#cb13-5"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="dv">475</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups10"></span>
<img src="_main_files/figure-html/fig-groups10-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610." width="672" />
<p class="caption">
Figure 3.11: The example of two variables measured on a number of samples. Cut on abeta=610.
</p>
</div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="dectr.html#cb14-1"></a><span class="co"># Select variable</span></span>
<span id="cb14-2"><a href="dectr.html#cb14-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb14-3"><a href="dectr.html#cb14-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb14-4"><a href="dectr.html#cb14-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb14-5"><a href="dectr.html#cb14-5"></a></span>
<span id="cb14-6"><a href="dectr.html#cb14-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb14-7"><a href="dectr.html#cb14-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb14-8"><a href="dectr.html#cb14-8"></a></span>
<span id="cb14-9"><a href="dectr.html#cb14-9"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb14-10"><a href="dectr.html#cb14-10"></a>                <span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,</span>
<span id="cb14-11"><a href="dectr.html#cb14-11"></a>                <span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">0</span>,<span class="dv">7</span>), <span class="dv">3</span>, <span class="dv">7</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb14-12"><a href="dectr.html#cb14-12"></a></span>
<span id="cb14-13"><a href="dectr.html#cb14-13"></a>limited_data2&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]</span>
<span id="cb14-14"><a href="dectr.html#cb14-14"></a>limited_data3&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]</span>
<span id="cb14-15"><a href="dectr.html#cb14-15"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb14-16"><a href="dectr.html#cb14-16"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb14-17"><a href="dectr.html#cb14-17"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb14-18"><a href="dectr.html#cb14-18"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb14-19"><a href="dectr.html#cb14-19"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">610</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb14-20"><a href="dectr.html#cb14-20"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb14-21"><a href="dectr.html#cb14-21"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb14-22"><a href="dectr.html#cb14-22"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb14-23"><a href="dectr.html#cb14-23"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb14-24"><a href="dectr.html#cb14-24"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">480</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb14-25"><a href="dectr.html#cb14-25"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb14-26"><a href="dectr.html#cb14-26"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=610&quot;</span>)</span>
<span id="cb14-27"><a href="dectr.html#cb14-27"></a></span>
<span id="cb14-28"><a href="dectr.html#cb14-28"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb14-29"><a href="dectr.html#cb14-29"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="dv">475</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb14-30"><a href="dectr.html#cb14-30"></a></span>
<span id="cb14-31"><a href="dectr.html#cb14-31"></a></span>
<span id="cb14-32"><a href="dectr.html#cb14-32"></a><span class="kw">plot</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,variableIndex],limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb14-33"><a href="dectr.html#cb14-33"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;480&quot;</span>)</span>
<span id="cb14-34"><a href="dectr.html#cb14-34"></a></span>
<span id="cb14-35"><a href="dectr.html#cb14-35"></a>vps4 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb14-36"><a href="dectr.html#cb14-36"></a></span>
<span id="cb14-37"><a href="dectr.html#cb14-37"></a></span>
<span id="cb14-38"><a href="dectr.html#cb14-38"></a><span class="kw">plot</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,variableIndex],limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb14-39"><a href="dectr.html#cb14-39"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=480&quot;</span>)</span>
<span id="cb14-40"><a href="dectr.html#cb14-40"></a></span>
<span id="cb14-41"><a href="dectr.html#cb14-41"></a>vps5 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb14-42"><a href="dectr.html#cb14-42"></a></span>
<span id="cb14-43"><a href="dectr.html#cb14-43"></a></span>
<span id="cb14-44"><a href="dectr.html#cb14-44"></a></span>
<span id="cb14-45"><a href="dectr.html#cb14-45"></a><span class="kw">plot</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,variableIndex],limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb14-46"><a href="dectr.html#cb14-46"></a>    <span class="dt">col=</span><span class="dv">2</span>,<span class="dt">main=</span><span class="st">&quot;t-tau&lt;480&quot;</span>)</span>
<span id="cb14-47"><a href="dectr.html#cb14-47"></a></span>
<span id="cb14-48"><a href="dectr.html#cb14-48"></a>vps6 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb14-49"><a href="dectr.html#cb14-49"></a></span>
<span id="cb14-50"><a href="dectr.html#cb14-50"></a></span>
<span id="cb14-51"><a href="dectr.html#cb14-51"></a><span class="kw">plot</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,variableIndex],limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb14-52"><a href="dectr.html#cb14-52"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;t-tau&gt;=480&quot;</span>)</span>
<span id="cb14-53"><a href="dectr.html#cb14-53"></a></span>
<span id="cb14-54"><a href="dectr.html#cb14-54"></a>vps7 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb14-55"><a href="dectr.html#cb14-55"></a></span>
<span id="cb14-56"><a href="dectr.html#cb14-56"></a></span>
<span id="cb14-57"><a href="dectr.html#cb14-57"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb14-58"><a href="dectr.html#cb14-58"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb14-59"><a href="dectr.html#cb14-59"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb14-60"><a href="dectr.html#cb14-60"></a></span>
<span id="cb14-61"><a href="dectr.html#cb14-61"></a></span>
<span id="cb14-62"><a href="dectr.html#cb14-62"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb14-63"><a href="dectr.html#cb14-63"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb14-64"><a href="dectr.html#cb14-64"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb14-65"><a href="dectr.html#cb14-65"></a></span>
<span id="cb14-66"><a href="dectr.html#cb14-66"></a></span>
<span id="cb14-67"><a href="dectr.html#cb14-67"></a></span>
<span id="cb14-68"><a href="dectr.html#cb14-68"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb14-69"><a href="dectr.html#cb14-69"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps4, </span>
<span id="cb14-70"><a href="dectr.html#cb14-70"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb14-71"><a href="dectr.html#cb14-71"></a></span>
<span id="cb14-72"><a href="dectr.html#cb14-72"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb14-73"><a href="dectr.html#cb14-73"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps5, </span>
<span id="cb14-74"><a href="dectr.html#cb14-74"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb14-75"><a href="dectr.html#cb14-75"></a></span>
<span id="cb14-76"><a href="dectr.html#cb14-76"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb14-77"><a href="dectr.html#cb14-77"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps6, </span>
<span id="cb14-78"><a href="dectr.html#cb14-78"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb14-79"><a href="dectr.html#cb14-79"></a></span>
<span id="cb14-80"><a href="dectr.html#cb14-80"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb14-81"><a href="dectr.html#cb14-81"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps7, </span>
<span id="cb14-82"><a href="dectr.html#cb14-82"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups11"></span>
<img src="_main_files/figure-html/fig-groups11-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480." width="1440" />
<p class="caption">
Figure 3.12: The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480.
</p>
</div>
<p>We choose to stop now. We have a tree with four leaves (plots at the bottom) but how do we do prediction? We first have a look at the group distribution in the leaves of the tree. The first two leaves on the left have AD as the most common group so any new samples that can reach these leaves can be classified as AD. Similarly, any new sample that reaches the two right leaves can be classified as control.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="dectr.html#cb15-1"></a><span class="co"># Select variable</span></span>
<span id="cb15-2"><a href="dectr.html#cb15-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb15-3"><a href="dectr.html#cb15-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb15-4"><a href="dectr.html#cb15-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb15-5"><a href="dectr.html#cb15-5"></a></span>
<span id="cb15-6"><a href="dectr.html#cb15-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb15-7"><a href="dectr.html#cb15-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb15-8"><a href="dectr.html#cb15-8"></a></span>
<span id="cb15-9"><a href="dectr.html#cb15-9"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb15-10"><a href="dectr.html#cb15-10"></a>                <span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,</span>
<span id="cb15-11"><a href="dectr.html#cb15-11"></a>                <span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">0</span>,<span class="dv">7</span>), <span class="dv">3</span>, <span class="dv">7</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb15-12"><a href="dectr.html#cb15-12"></a></span>
<span id="cb15-13"><a href="dectr.html#cb15-13"></a>limited_data2&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]</span>
<span id="cb15-14"><a href="dectr.html#cb15-14"></a>limited_data3&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]</span>
<span id="cb15-15"><a href="dectr.html#cb15-15"></a></span>
<span id="cb15-16"><a href="dectr.html#cb15-16"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb15-17"><a href="dectr.html#cb15-17"></a></span>
<span id="cb15-18"><a href="dectr.html#cb15-18"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb15-19"><a href="dectr.html#cb15-19"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb15-20"><a href="dectr.html#cb15-20"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb15-21"><a href="dectr.html#cb15-21"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb15-22"><a href="dectr.html#cb15-22"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb15-23"><a href="dectr.html#cb15-23"></a></span>
<span id="cb15-24"><a href="dectr.html#cb15-24"></a></span>
<span id="cb15-25"><a href="dectr.html#cb15-25"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=610&quot;</span>)</span>
<span id="cb15-26"><a href="dectr.html#cb15-26"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb15-27"><a href="dectr.html#cb15-27"></a></span>
<span id="cb15-28"><a href="dectr.html#cb15-28"></a></span>
<span id="cb15-29"><a href="dectr.html#cb15-29"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;abeta&lt;480&quot;</span>)</span>
<span id="cb15-30"><a href="dectr.html#cb15-30"></a></span>
<span id="cb15-31"><a href="dectr.html#cb15-31"></a>vps4 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb15-32"><a href="dectr.html#cb15-32"></a></span>
<span id="cb15-33"><a href="dectr.html#cb15-33"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=480&quot;</span>)</span>
<span id="cb15-34"><a href="dectr.html#cb15-34"></a>vps5 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb15-35"><a href="dectr.html#cb15-35"></a></span>
<span id="cb15-36"><a href="dectr.html#cb15-36"></a></span>
<span id="cb15-37"><a href="dectr.html#cb15-37"></a></span>
<span id="cb15-38"><a href="dectr.html#cb15-38"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;t-tau&lt;480&quot;</span>)</span>
<span id="cb15-39"><a href="dectr.html#cb15-39"></a></span>
<span id="cb15-40"><a href="dectr.html#cb15-40"></a>vps6 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb15-41"><a href="dectr.html#cb15-41"></a></span>
<span id="cb15-42"><a href="dectr.html#cb15-42"></a></span>
<span id="cb15-43"><a href="dectr.html#cb15-43"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;t-tau&gt;=480&quot;</span>)</span>
<span id="cb15-44"><a href="dectr.html#cb15-44"></a></span>
<span id="cb15-45"><a href="dectr.html#cb15-45"></a>vps7 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb15-46"><a href="dectr.html#cb15-46"></a></span>
<span id="cb15-47"><a href="dectr.html#cb15-47"></a></span>
<span id="cb15-48"><a href="dectr.html#cb15-48"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb15-49"><a href="dectr.html#cb15-49"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb15-50"><a href="dectr.html#cb15-50"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-51"><a href="dectr.html#cb15-51"></a></span>
<span id="cb15-52"><a href="dectr.html#cb15-52"></a></span>
<span id="cb15-53"><a href="dectr.html#cb15-53"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb15-54"><a href="dectr.html#cb15-54"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb15-55"><a href="dectr.html#cb15-55"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-56"><a href="dectr.html#cb15-56"></a></span>
<span id="cb15-57"><a href="dectr.html#cb15-57"></a></span>
<span id="cb15-58"><a href="dectr.html#cb15-58"></a></span>
<span id="cb15-59"><a href="dectr.html#cb15-59"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb15-60"><a href="dectr.html#cb15-60"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps4, </span>
<span id="cb15-61"><a href="dectr.html#cb15-61"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-62"><a href="dectr.html#cb15-62"></a></span>
<span id="cb15-63"><a href="dectr.html#cb15-63"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb15-64"><a href="dectr.html#cb15-64"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps5, </span>
<span id="cb15-65"><a href="dectr.html#cb15-65"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-66"><a href="dectr.html#cb15-66"></a></span>
<span id="cb15-67"><a href="dectr.html#cb15-67"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb15-68"><a href="dectr.html#cb15-68"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps6, </span>
<span id="cb15-69"><a href="dectr.html#cb15-69"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-70"><a href="dectr.html#cb15-70"></a></span>
<span id="cb15-71"><a href="dectr.html#cb15-71"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb15-72"><a href="dectr.html#cb15-72"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps7, </span>
<span id="cb15-73"><a href="dectr.html#cb15-73"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-74"><a href="dectr.html#cb15-74"></a></span>
<span id="cb15-75"><a href="dectr.html#cb15-75"></a><span class="kw">grid.text</span>(<span class="st">&quot;AD&quot;</span>,<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">y=</span><span class="kw">unit</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">vp=</span>vps4,<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-76"><a href="dectr.html#cb15-76"></a><span class="kw">grid.text</span>(<span class="st">&quot;AD&quot;</span>,<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">y=</span><span class="kw">unit</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">vp=</span>vps5,<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-77"><a href="dectr.html#cb15-77"></a><span class="kw">grid.text</span>(<span class="st">&quot;Control&quot;</span>,<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">y=</span><span class="kw">unit</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">vp=</span>vps6,<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>))</span>
<span id="cb15-78"><a href="dectr.html#cb15-78"></a><span class="kw">grid.text</span>(<span class="st">&quot;Control&quot;</span>,<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">y=</span><span class="kw">unit</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">vp=</span>vps7,<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups12"></span>
<img src="_main_files/figure-html/fig-groups12-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480." width="1440" />
<p class="caption">
Figure 3.13: The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480.
</p>
</div>
<p>To do the classification, we just need to follow the rules we have derived in the previous steps. At the very beginning (the root of the tree), we used <span class="math inline">\(A\beta=610\)</span>, on the left-hand side we used <span class="math inline">\(a\beta=480\)</span> and on the right-hand side, we used <span class="math inline">\(t tau=475\)</span>. So for a new sample, we first test where its <span class="math inline">\(A\beta\)</span> is lower than 610, if yes, it goes to the left of the tree otherwise it will go to the right side. If for example, it goes to the left side, we again test <span class="math inline">\(A\beta\)</span> and send the sample to the suitable leaf. The label of the leaf will show the classification of this new sample. The decision rules are shown in figure <a href="dectr.html#fig:fig-groups13">3.14</a>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="dectr.html#cb16-1"></a>limited_data2&lt;-limited_data</span>
<span id="cb16-2"><a href="dectr.html#cb16-2"></a>limited_data2<span class="op">$</span>group&lt;-<span class="kw">factor</span>(limited_data2<span class="op">$</span>group)</span>
<span id="cb16-3"><a href="dectr.html#cb16-3"></a>tt&lt;-tree<span class="op">::</span><span class="kw">tree</span>(group<span class="op">~</span>abeta<span class="op">+</span>t_tau,<span class="dt">data=</span>limited_data2,<span class="dt">split=</span><span class="st">&quot;gini&quot;</span>,<span class="dt">mincut=</span><span class="dv">12</span>)</span>
<span id="cb16-4"><a href="dectr.html#cb16-4"></a></span>
<span id="cb16-5"><a href="dectr.html#cb16-5"></a>tt<span class="op">$</span>frame[<span class="dv">1</span>,<span class="dv">5</span>][<span class="dv">1</span>]&lt;-<span class="st">&quot;&lt;610&quot;</span></span>
<span id="cb16-6"><a href="dectr.html#cb16-6"></a>tt<span class="op">$</span>frame[<span class="dv">2</span>,<span class="dv">5</span>][<span class="dv">1</span>]&lt;-<span class="st">&quot;&lt;480&quot;</span></span>
<span id="cb16-7"><a href="dectr.html#cb16-7"></a>tt<span class="op">$</span>frame[<span class="dv">11</span>,<span class="dv">5</span>][<span class="dv">1</span>]&lt;-<span class="st">&quot;&lt;475&quot;</span></span>
<span id="cb16-8"><a href="dectr.html#cb16-8"></a></span>
<span id="cb16-9"><a href="dectr.html#cb16-9"></a>tt<span class="op">$</span>frame[<span class="dv">3</span>,<span class="dv">1</span>]&lt;-<span class="st">&quot;&lt;leaf&gt;&quot;</span></span>
<span id="cb16-10"><a href="dectr.html#cb16-10"></a>tt<span class="op">$</span>frame[<span class="dv">3</span>,<span class="dv">5</span>]&lt;-tt<span class="op">$</span>frame[<span class="dv">4</span>,<span class="dv">5</span>]</span>
<span id="cb16-11"><a href="dectr.html#cb16-11"></a></span>
<span id="cb16-12"><a href="dectr.html#cb16-12"></a>tt<span class="op">$</span>frame&lt;-tt<span class="op">$</span>frame[<span class="op">-</span><span class="kw">c</span>(<span class="dv">5</span><span class="op">:</span><span class="dv">10</span>),]</span>
<span id="cb16-13"><a href="dectr.html#cb16-13"></a><span class="kw">rownames</span>(tt<span class="op">$</span>frame)[<span class="dv">4</span>]&lt;-<span class="st">&quot;5&quot;</span></span>
<span id="cb16-14"><a href="dectr.html#cb16-14"></a><span class="kw">plot</span>(tt)</span>
<span id="cb16-15"><a href="dectr.html#cb16-15"></a><span class="kw">text</span>(tt,<span class="dt">pretty=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups13"></span>
<img src="_main_files/figure-html/fig-groups13-1.png" alt="The example of rules derived for the tree" width="1440" />
<p class="caption">
Figure 3.14: The example of rules derived for the tree
</p>
</div>
<p>In the beginning, we said that decision trees segments our data. We can have a look at our toy example and see how this segmentation has been done:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="dectr.html#cb17-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb17-2"><a href="dectr.html#cb17-2"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb17-3"><a href="dectr.html#cb17-3"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb17-4"><a href="dectr.html#cb17-4"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">610</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb17-5"><a href="dectr.html#cb17-5"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">480</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb17-6"><a href="dectr.html#cb17-6"></a><span class="kw">lines</span>(<span class="dt">x=</span><span class="kw">c</span>(<span class="dv">610</span>,<span class="dv">10000</span>),<span class="dt">y=</span><span class="kw">c</span>(<span class="dv">475</span>,<span class="dv">610</span>),<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb17-7"><a href="dectr.html#cb17-7"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="dt">legend =</span> <span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group)),</span>
<span id="cb17-8"><a href="dectr.html#cb17-8"></a>       <span class="dt">col=</span><span class="kw">as.factor</span>(<span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))),</span>
<span id="cb17-9"><a href="dectr.html#cb17-9"></a>       <span class="dt">pch=</span><span class="dv">1</span>)</span>
<span id="cb17-10"><a href="dectr.html#cb17-10"></a></span>
<span id="cb17-11"><a href="dectr.html#cb17-11"></a><span class="kw">text</span>(<span class="dv">300</span>,<span class="dv">1000</span>,<span class="st">&quot;AD&quot;</span>,<span class="dt">font=</span><span class="dv">4</span>)</span>
<span id="cb17-12"><a href="dectr.html#cb17-12"></a><span class="kw">text</span>(<span class="dv">550</span>,<span class="dv">1000</span>,<span class="st">&quot;AD&quot;</span>,<span class="dt">font=</span><span class="dv">4</span>)</span>
<span id="cb17-13"><a href="dectr.html#cb17-13"></a><span class="kw">text</span>(<span class="dv">1000</span>,<span class="dv">1000</span>,<span class="st">&quot;Control&quot;</span>,<span class="dt">font=</span><span class="dv">4</span>)</span>
<span id="cb17-14"><a href="dectr.html#cb17-14"></a><span class="kw">text</span>(<span class="dv">1000</span>,<span class="dv">300</span>,<span class="st">&quot;Control&quot;</span>,<span class="dt">font=</span><span class="dv">4</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups14"></span>
<img src="_main_files/figure-html/fig-groups14-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480." width="672" />
<p class="caption">
Figure 3.15: The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480.
</p>
</div>
</div>
<div id="classification" class="section level2">
<h2><span class="header-section-number">3.2</span> Classification</h2>
<p>Now that we could build a tree by hand, let’s try to formally define how we can automatically do that.
I guess you have noticed that, for a small number of samples and two classes, it’s relatively simple to derive segmentation rules. But look at the figure below, it’s certainly a big task to find a line to best separate the groups.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="dectr.html#cb18-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb18-2"><a href="dectr.html#cb18-2"></a><span class="co"># Select variable</span></span>
<span id="cb18-3"><a href="dectr.html#cb18-3"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb18-4"><a href="dectr.html#cb18-4"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb18-5"><a href="dectr.html#cb18-5"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb18-6"><a href="dectr.html#cb18-6"></a><span class="kw">plot</span>(data[,variableIndex],data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb18-7"><a href="dectr.html#cb18-7"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(data<span class="op">$</span>group))</span>
<span id="cb18-8"><a href="dectr.html#cb18-8"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="dt">legend =</span> <span class="kw">levels</span>(<span class="kw">as.factor</span>(data<span class="op">$</span>group)),</span>
<span id="cb18-9"><a href="dectr.html#cb18-9"></a>       <span class="dt">col=</span><span class="kw">as.factor</span>(<span class="kw">levels</span>(<span class="kw">as.factor</span>(data<span class="op">$</span>group))),</span>
<span id="cb18-10"><a href="dectr.html#cb18-10"></a>       <span class="dt">pch=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups15"></span>
<img src="_main_files/figure-html/fig-groups15-1.png" alt="The example of two variables measured on a number of samples. All the groups are shown!" width="672" />
<p class="caption">
Figure 3.16: The example of two variables measured on a number of samples. All the groups are shown!
</p>
</div>
<p>There are many measures that can be used to derive the rules. Two of the most used ones are Gini impurity and information gain.</p>
<div id="gini-index-gini-impurity-and-gini-gain" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Gini index, Gini impurity and Gini gain</h3>
<p>Let’s one more time have a look at our limited dataset (only two groups) but with respect to two tree variables.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="dectr.html#cb19-1"></a><span class="co"># Select variable</span></span>
<span id="cb19-2"><a href="dectr.html#cb19-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb19-3"><a href="dectr.html#cb19-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb19-4"><a href="dectr.html#cb19-4"></a>variableIndex2&lt;-<span class="st">&quot;p_tau&quot;</span></span>
<span id="cb19-5"><a href="dectr.html#cb19-5"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb19-6"><a href="dectr.html#cb19-6"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb19-7"><a href="dectr.html#cb19-7"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb19-8"><a href="dectr.html#cb19-8"></a><span class="kw">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="dt">legend =</span> <span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group)),</span>
<span id="cb19-9"><a href="dectr.html#cb19-9"></a>       <span class="dt">col=</span><span class="kw">as.factor</span>(<span class="kw">levels</span>(<span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))),</span>
<span id="cb19-10"><a href="dectr.html#cb19-10"></a>       <span class="dt">pch=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups16"></span>
<img src="_main_files/figure-html/fig-groups16-1.png" alt="The example of two variables measured on a number of samples." width="672" />
<p class="caption">
Figure 3.17: The example of two variables measured on a number of samples.
</p>
</div>
<p>What is the probability of selecting an AD sample just by chance? Well, that is simple, we could just take the number of AD cases and divided by the total number of cases $p(AD)==$0.63. Gini index ask what is the chance of randomly picking two data points from the same group? Well, if our draws are independent, then it’s simply squared what we have calculated before so <span class="math inline">\(p(AD)^2\)</span>! Now we have two classes, so we have to do this for the control as well: $p(control)==$0.37. We can now combine these two just by summing them up, giving us the probability of selecting two random samples with the same group: <span class="math inline">\(p=p(AD)^2+p(control)^2\)</span>. What is the probability of selecting two points with different groups? That is simply <span class="math inline">\(1-(p(AD)^2+p(control)^2)\)</span>. This is Gini impurity. It just tells the probability of classifying a random point incorrectly. We can extend this to any number of classes using:</p>
<p><span class="math display">\[\text{Gini impurity}=1-\sum_{i}^{C}{p(i)^2}\]</span>
Where <span class="math inline">\(i\)</span> is a group or a class of observation. But how we are going to use this in decision trees?
We first calculate Gini impurity for the whole dataset: In our case, Gini impurity is 0.4671812.</p>
<p>Now we have to decide which variable to select for segmenting our data and where to cut that variable.
In this stage, we will go through all variables and all different cut points and calculate the total impurity of the resulting segments.
For example, let’s take our previous example:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="dectr.html#cb20-1"></a><span class="co"># Select variable</span></span>
<span id="cb20-2"><a href="dectr.html#cb20-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb20-3"><a href="dectr.html#cb20-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb20-4"><a href="dectr.html#cb20-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb20-5"><a href="dectr.html#cb20-5"></a></span>
<span id="cb20-6"><a href="dectr.html#cb20-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb20-7"><a href="dectr.html#cb20-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb20-8"><a href="dectr.html#cb20-8"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">3</span>), <span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb20-9"><a href="dectr.html#cb20-9"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb20-10"><a href="dectr.html#cb20-10"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data<span class="op">$</span>group))</span>
<span id="cb20-11"><a href="dectr.html#cb20-11"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb20-12"><a href="dectr.html#cb20-12"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb20-13"><a href="dectr.html#cb20-13"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">610</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb20-14"><a href="dectr.html#cb20-14"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb20-15"><a href="dectr.html#cb20-15"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>,<span class="dt">sub=</span><span class="kw">paste</span>(<span class="st">&quot;Gini imputriy =&quot;</span>,<span class="kw">round</span>(mltools<span class="op">::</span><span class="kw">gini_impurity</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dv">2</span>)))</span>
<span id="cb20-16"><a href="dectr.html#cb20-16"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb20-17"><a href="dectr.html#cb20-17"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb20-18"><a href="dectr.html#cb20-18"></a></span>
<span id="cb20-19"><a href="dectr.html#cb20-19"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb20-20"><a href="dectr.html#cb20-20"></a>    <span class="dt">col=</span><span class="kw">as.factor</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=610&quot;</span>,<span class="dt">sub=</span><span class="kw">paste</span>(<span class="st">&quot;Gini imputriy =&quot;</span>,<span class="kw">round</span>(mltools<span class="op">::</span><span class="kw">gini_impurity</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group),<span class="dv">2</span>)))</span>
<span id="cb20-21"><a href="dectr.html#cb20-21"></a></span>
<span id="cb20-22"><a href="dectr.html#cb20-22"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb20-23"><a href="dectr.html#cb20-23"></a></span>
<span id="cb20-24"><a href="dectr.html#cb20-24"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb20-25"><a href="dectr.html#cb20-25"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb20-26"><a href="dectr.html#cb20-26"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb20-27"><a href="dectr.html#cb20-27"></a></span>
<span id="cb20-28"><a href="dectr.html#cb20-28"></a></span>
<span id="cb20-29"><a href="dectr.html#cb20-29"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb20-30"><a href="dectr.html#cb20-30"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb20-31"><a href="dectr.html#cb20-31"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups17"></span>
<img src="_main_files/figure-html/fig-groups17-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610. The top plot shows all the data. The left figure shows the data points where abeta is &lt;610 and the right plot shows the data points with abeta &gt;=610" width="672" />
<p class="caption">
Figure 3.18: The example of two variables measured on a number of samples. Cut on abeta=610. The top plot shows all the data. The left figure shows the data points where abeta is &lt;610 and the right plot shows the data points with abeta &gt;=610
</p>
</div>
<p>Here we split the data at <span class="math inline">\(A\beta=610\)</span> giving us two segments (left and right). Let’s start with the left one and calculate its Gini imputriy (<span class="math inline">\(GI_\text{left}=\)</span> 0.33) and do the similar thing with the plot on the right (<span class="math inline">\(GI_\text{right}=\)</span> 0.33). Now we simply weight this two number by the fraction of the total data in each of the segments. The left plot has 91 data points so the fraction becomes <span class="math inline">\(w_\text{left}=\)</span> 91/121= 0.75 and the right plot has 30 points so the fraction becomes <span class="math inline">\(w_\text{righ}=\)</span> 30/121= 0.25. Our final total Gini impurity is calculated as <span class="math inline">\(GI_\text{left}*w_\text{left}+GI_\text{right}*w_\text{right}=\)</span> 0.3306818</p>
<p>Now we have the impurity of the segmentation. The question is how much of impurity we have removed from the original data? We can simply subtract Our original Gini impurity by <span class="math inline">\(GI_\text{left}*w_\text{left}+GI_\text{right}*w_\text{right}=\)</span> so it will become 0.1614021. This is known as Gini Gain. The higher this value, the better the split would be. Here is a little function that does the Gini gain calculation (click on the code button!).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="dectr.html#cb21-1"></a>gini_gain&lt;-<span class="cf">function</span>(x,group,cutoff){</span>
<span id="cb21-2"><a href="dectr.html#cb21-2"></a>  </span>
<span id="cb21-3"><a href="dectr.html#cb21-3"></a>  <span class="cf">if</span>(<span class="kw">is.character</span>(cutoff))</span>
<span id="cb21-4"><a href="dectr.html#cb21-4"></a>  {</span>
<span id="cb21-5"><a href="dectr.html#cb21-5"></a>  original_gini&lt;-mltools<span class="op">::</span><span class="kw">gini_impurity</span>(group)</span>
<span id="cb21-6"><a href="dectr.html#cb21-6"></a>  gini_left&lt;-mltools<span class="op">::</span><span class="kw">gini_impurity</span>(group[<span class="kw">which</span>(x<span class="op">%in%</span>cutoff)])</span>
<span id="cb21-7"><a href="dectr.html#cb21-7"></a>  gini_right&lt;-mltools<span class="op">::</span><span class="kw">gini_impurity</span>(group[<span class="kw">which</span>(<span class="op">!</span>x<span class="op">%in%</span>cutoff)])</span>
<span id="cb21-8"><a href="dectr.html#cb21-8"></a>  weight_left&lt;-<span class="kw">length</span>(group[<span class="kw">which</span>(x<span class="op">%in%</span>cutoff)])<span class="op">/</span><span class="kw">length</span>(group)</span>
<span id="cb21-9"><a href="dectr.html#cb21-9"></a>   weight_right&lt;-<span class="kw">length</span>(group[<span class="kw">which</span>(<span class="op">!</span>x<span class="op">%in%</span>cutoff)])<span class="op">/</span><span class="kw">length</span>(group)</span>
<span id="cb21-10"><a href="dectr.html#cb21-10"></a>    </span>
<span id="cb21-11"><a href="dectr.html#cb21-11"></a>  }<span class="cf">else</span>{</span>
<span id="cb21-12"><a href="dectr.html#cb21-12"></a>  original_gini&lt;-mltools<span class="op">::</span><span class="kw">gini_impurity</span>(group)</span>
<span id="cb21-13"><a href="dectr.html#cb21-13"></a>  gini_left&lt;-mltools<span class="op">::</span><span class="kw">gini_impurity</span>(group[<span class="kw">which</span>(x<span class="op">&lt;</span>cutoff)])</span>
<span id="cb21-14"><a href="dectr.html#cb21-14"></a>  gini_right&lt;-mltools<span class="op">::</span><span class="kw">gini_impurity</span>(group[<span class="kw">which</span>(x<span class="op">&gt;=</span>cutoff)])</span>
<span id="cb21-15"><a href="dectr.html#cb21-15"></a>  weight_left&lt;-<span class="kw">length</span>(group[<span class="kw">which</span>(x<span class="op">&lt;</span>cutoff)])<span class="op">/</span><span class="kw">length</span>(group)</span>
<span id="cb21-16"><a href="dectr.html#cb21-16"></a>   weight_right&lt;-<span class="kw">length</span>(group[<span class="kw">which</span>(x<span class="op">&gt;=</span>cutoff)])<span class="op">/</span><span class="kw">length</span>(group)</span>
<span id="cb21-17"><a href="dectr.html#cb21-17"></a>  }</span>
<span id="cb21-18"><a href="dectr.html#cb21-18"></a>   <span class="kw">return</span>(original_gini<span class="op">-</span>(gini_left<span class="op">*</span>weight_left<span class="op">+</span>gini_right<span class="op">*</span>weight_right))</span>
<span id="cb21-19"><a href="dectr.html#cb21-19"></a>}</span></code></pre></div>
</div>
<div id="entropy-and-information-gain" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Entropy and information gain</h3>
<p>Similar to the Gini index, entropy is an information theory metric that measures the impurity of a set of observations with respect to a grouping variable. The way to calculate entropy and information gain is very similar to Gini.</p>
<p><span class="math display">\[\text{Entropy}=1-\sum_{i}^{C}{p(i)log{_2}{p(i)}}\]</span>
Where <span class="math inline">\(i\)</span> can be any classes from a total of <span class="math inline">\(C\)</span> classes. The rest of the calculations are similar to Gini. We can calculate the information gain of a parent node simply but subtracting the entropy of the child nodes from the entropy of the parent. In practice, both of these methods result in very similar splits but Gini is faster and is often preferred for this reason.</p>
</div>
</div>
<div id="regression" class="section level2">
<h2><span class="header-section-number">3.3</span> Regression</h2>
<p>A decision tree can also be used where your <span class="math inline">\(y\)</span> variable is continuous. In this case, you are doing a regression. The good part is that doing regression using decision trees is not that different from doing classification. The only thing we have to change is our measure for determining the split. In classification, we used Gini or entropy but in regression, we use Mean Square Error (MSE) or similar measures.</p>
<p>Let’s have a look at our data again but this time instead of looking at the group (e.g., AD or control) we will have a look at the MMT score.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="dectr.html#cb22-1"></a><span class="co"># Select variable</span></span>
<span id="cb22-2"><a href="dectr.html#cb22-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb22-3"><a href="dectr.html#cb22-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb22-4"><a href="dectr.html#cb22-4"></a><span class="co"># create color gradient</span></span>
<span id="cb22-5"><a href="dectr.html#cb22-5"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb22-6"><a href="dectr.html#cb22-6"></a>grad &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>))</span>
<span id="cb22-7"><a href="dectr.html#cb22-7"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb22-8"><a href="dectr.html#cb22-8"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb22-9"><a href="dectr.html#cb22-9"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb22-10"><a href="dectr.html#cb22-10"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>)</span>
<span id="cb22-11"><a href="dectr.html#cb22-11"></a></span>
<span id="cb22-12"><a href="dectr.html#cb22-12"></a>legend_image &lt;-<span class="st"> </span><span class="kw">as.raster</span>(<span class="kw">matrix</span>(<span class="kw">grad</span>(<span class="dv">10</span>), <span class="dt">ncol=</span><span class="dv">1</span>))</span>
<span id="cb22-13"><a href="dectr.html#cb22-13"></a><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">type =</span> <span class="st">&#39;n&#39;</span>, <span class="dt">axes =</span> F,<span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;MMT score&#39;</span>)</span>
<span id="cb22-14"><a href="dectr.html#cb22-14"></a><span class="kw">text</span>(<span class="dt">x=</span><span class="fl">1.5</span>, <span class="dt">y =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">l=</span><span class="dv">5</span>), <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="kw">max</span>(limited_data<span class="op">$</span>mmt),<span class="kw">min</span>(limited_data<span class="op">$</span>mmt),<span class="dt">l=</span><span class="dv">5</span>))</span>
<span id="cb22-15"><a href="dectr.html#cb22-15"></a><span class="kw">rasterImage</span>(legend_image, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups18"></span>
<img src="_main_files/figure-html/fig-groups18-1.png" alt="The example of two variables measured on a number of samples. The MMT score is shown as a gradient from red (lowest score) to blue (highest score)" width="672" />
<p class="caption">
Figure 3.19: The example of two variables measured on a number of samples. The MMT score is shown as a gradient from red (lowest score) to blue (highest score)
</p>
</div>
<p>Our goal here is to use <span class="math inline">\(A\beta\)</span> and t-tau to predict MMT scores for individuals. To do that, we first define our measure for where to segment the data. As pointed out before, we use MSE:</p>
<p><span class="math display">\[MSE=\frac{1}{n}\sum_{i=1}^{n}{(y_i-\bar{y_i})^2}\]</span></p>
<p>This essentially calculates the squared differences between each of our <span class="math inline">\(y\)</span> and the mean of all the ys (<span class="math inline">\(\bar{y}\)</span>). For example, if we want to calculate the MSE of our MMT scores for our <em>entire</em> dataset, we can calculate mean our MMSs=25.338843 then we subtract every single of our MMT scores from this mean and square them. Finally and take the average of this value: 17.5298135</p>
<p>Now how to use MSE to build a decision tree? We start by calculating MSE for our entire dataset like we did before: mean((limited_data<span class="math inline">\(mmt-mean(limited_data\)</span>mmt))^2)
We now select a variable, let’s say <span class="math inline">\(A\beta\)</span> and split it at some value:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="dectr.html#cb23-1"></a><span class="co"># Select variable</span></span>
<span id="cb23-2"><a href="dectr.html#cb23-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb23-3"><a href="dectr.html#cb23-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb23-4"><a href="dectr.html#cb23-4"></a><span class="co"># create color gradient</span></span>
<span id="cb23-5"><a href="dectr.html#cb23-5"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb23-6"><a href="dectr.html#cb23-6"></a>grad &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>))</span>
<span id="cb23-7"><a href="dectr.html#cb23-7"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb23-8"><a href="dectr.html#cb23-8"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb23-9"><a href="dectr.html#cb23-9"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb23-10"><a href="dectr.html#cb23-10"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;MSE=&quot;</span>,<span class="kw">round</span>(<span class="kw">mean</span>((limited_data<span class="op">$</span>mmt<span class="op">-</span><span class="kw">mean</span>(limited_data<span class="op">$</span>mmt))<span class="op">^</span><span class="dv">2</span>),<span class="dv">2</span>)))</span>
<span id="cb23-11"><a href="dectr.html#cb23-11"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">650</span>,<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb23-12"><a href="dectr.html#cb23-12"></a>legend_image &lt;-<span class="st"> </span><span class="kw">as.raster</span>(<span class="kw">matrix</span>(<span class="kw">grad</span>(<span class="dv">10</span>), <span class="dt">ncol=</span><span class="dv">1</span>))</span>
<span id="cb23-13"><a href="dectr.html#cb23-13"></a><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">type =</span> <span class="st">&#39;n&#39;</span>, <span class="dt">axes =</span> F,<span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;MMT score&#39;</span>)</span>
<span id="cb23-14"><a href="dectr.html#cb23-14"></a><span class="kw">text</span>(<span class="dt">x=</span><span class="fl">1.5</span>, <span class="dt">y =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">l=</span><span class="dv">5</span>), <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="kw">max</span>(limited_data<span class="op">$</span>mmt),<span class="kw">min</span>(limited_data<span class="op">$</span>mmt),<span class="dt">l=</span><span class="dv">5</span>))</span>
<span id="cb23-15"><a href="dectr.html#cb23-15"></a><span class="kw">rasterImage</span>(legend_image, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups19"></span>
<img src="_main_files/figure-html/fig-groups19-1.png" alt="The example of two variables measured on a number of samples. The MMT score is shown as a gradient from red (lowest score) to blue (highest score)" width="672" />
<p class="caption">
Figure 3.20: The example of two variables measured on a number of samples. The MMT score is shown as a gradient from red (lowest score) to blue (highest score)
</p>
</div>
<p>We now calculate the MSE of MMT for the left and right parts of the plot.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="dectr.html#cb24-1"></a><span class="co"># Select variable</span></span>
<span id="cb24-2"><a href="dectr.html#cb24-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb24-3"><a href="dectr.html#cb24-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb24-4"><a href="dectr.html#cb24-4"></a><span class="co"># create color gradient</span></span>
<span id="cb24-5"><a href="dectr.html#cb24-5"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb24-6"><a href="dectr.html#cb24-6"></a>grad &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>))</span>
<span id="cb24-7"><a href="dectr.html#cb24-7"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb24-8"><a href="dectr.html#cb24-8"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb24-9"><a href="dectr.html#cb24-9"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb24-10"><a href="dectr.html#cb24-10"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;MSE=&quot;</span>,<span class="kw">round</span>(<span class="kw">mean</span>((limited_data<span class="op">$</span>mmt<span class="op">-</span><span class="kw">mean</span>(limited_data<span class="op">$</span>mmt))<span class="op">^</span><span class="dv">2</span>),<span class="dv">2</span>)))</span>
<span id="cb24-11"><a href="dectr.html#cb24-11"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">650</span>,<span class="dt">lwd=</span><span class="dv">3</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb24-12"><a href="dectr.html#cb24-12"></a><span class="kw">text</span>(<span class="dt">x=</span><span class="dv">300</span>,<span class="dt">y=</span><span class="dv">1500</span>,<span class="kw">paste</span>(<span class="st">&quot;MSE=&quot;</span>,<span class="kw">round</span>(<span class="kw">mean</span>((limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">650</span>,]<span class="op">$</span>mmt<span class="op">-</span><span class="kw">mean</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">650</span>,]<span class="op">$</span>mmt))<span class="op">^</span><span class="dv">2</span>),<span class="dv">2</span>)))</span>
<span id="cb24-13"><a href="dectr.html#cb24-13"></a><span class="kw">text</span>(<span class="dt">x=</span><span class="dv">1000</span>,<span class="dt">y=</span><span class="dv">1500</span>,<span class="kw">paste</span>(<span class="st">&quot;MSE=&quot;</span>,<span class="kw">round</span>(<span class="kw">mean</span>((limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">650</span>,]<span class="op">$</span>mmt<span class="op">-</span><span class="kw">mean</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">650</span>,]<span class="op">$</span>mmt))<span class="op">^</span><span class="dv">2</span>),<span class="dv">2</span>)))</span>
<span id="cb24-14"><a href="dectr.html#cb24-14"></a>legend_image &lt;-<span class="st"> </span><span class="kw">as.raster</span>(<span class="kw">matrix</span>(<span class="kw">grad</span>(<span class="dv">10</span>), <span class="dt">ncol=</span><span class="dv">1</span>))</span>
<span id="cb24-15"><a href="dectr.html#cb24-15"></a><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">type =</span> <span class="st">&#39;n&#39;</span>, <span class="dt">axes =</span> F,<span class="dt">xlab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;&#39;</span>, <span class="dt">main =</span> <span class="st">&#39;MMT score&#39;</span>)</span>
<span id="cb24-16"><a href="dectr.html#cb24-16"></a><span class="kw">text</span>(<span class="dt">x=</span><span class="fl">1.5</span>, <span class="dt">y =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">l=</span><span class="dv">5</span>), <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="kw">max</span>(limited_data<span class="op">$</span>mmt),<span class="kw">min</span>(limited_data<span class="op">$</span>mmt),<span class="dt">l=</span><span class="dv">5</span>))</span>
<span id="cb24-17"><a href="dectr.html#cb24-17"></a><span class="kw">rasterImage</span>(legend_image, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups20"></span>
<img src="_main_files/figure-html/fig-groups20-1.png" alt="The example of two variables measured on a number of samples. The MMT score is shown as a gradient from red (lowest score) to blue (highest score)" width="672" />
<p class="caption">
Figure 3.21: The example of two variables measured on a number of samples. The MMT score is shown as a gradient from red (lowest score) to blue (highest score)
</p>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="dectr.html#cb25-1"></a>(<span class="kw">round</span>(<span class="kw">mean</span>((limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">650</span>,]<span class="op">$</span>mmt<span class="op">-</span><span class="kw">mean</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">650</span>,]<span class="op">$</span>mmt))<span class="op">^</span><span class="dv">2</span>),<span class="dv">2</span>)<span class="op">*</span>(<span class="kw">sum</span>(limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">650</span>)<span class="op">/</span><span class="kw">length</span>(limited_data<span class="op">$</span>abeta)))<span class="op">+</span>(<span class="kw">round</span>(<span class="kw">mean</span>((limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">650</span>,]<span class="op">$</span>mmt<span class="op">-</span><span class="kw">mean</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">650</span>,]<span class="op">$</span>mmt))<span class="op">^</span><span class="dv">2</span>),<span class="dv">2</span>)<span class="op">*</span>(<span class="kw">sum</span>(limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">650</span>)<span class="op">/</span><span class="kw">length</span>(limited_data<span class="op">$</span>abeta)))</span></code></pre></div>
<pre><code>## [1] 16.12248</code></pre>
<p>We now weight the two MSEs by the proportion of the number of data points on each side of the split and sum them up (exactly like total Gini): <span class="math inline">\(MSE_\text{left}*w_\text{left}+MSE_\text{right}*w_\text{right}= 16.9 \times \frac{93}{121} + 13.54 \times \frac{28}{121}=16.12\)</span></p>
<p>Now we have the MSE of the split. We will go ahead and subtract the MSE for the entire dataset by the MSE of the split: <span class="math inline">\(MSE_{parent}-MSE_{split}=17.53-16.12=1.41\)</span></p>
<p>Our aim is every time we want to do a split in the tree, we select a variable and a cut point that maximize variance reduction. The rest of the story is almost exactly like the classification. The only big difference is that when we go to the leaf of the tree and want to do a prediction. We use the average of <span class="math inline">\(y\)</span> variable in that leaf as the predicted value. For example. Let’s say we build a tree and it looks like this:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="dectr.html#cb27-1"></a><span class="co"># Select variable</span></span>
<span id="cb27-2"><a href="dectr.html#cb27-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb27-3"><a href="dectr.html#cb27-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb27-4"><a href="dectr.html#cb27-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb27-5"><a href="dectr.html#cb27-5"></a></span>
<span id="cb27-6"><a href="dectr.html#cb27-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb27-7"><a href="dectr.html#cb27-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb27-8"><a href="dectr.html#cb27-8"></a></span>
<span id="cb27-9"><a href="dectr.html#cb27-9"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb27-10"><a href="dectr.html#cb27-10"></a>                <span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,</span>
<span id="cb27-11"><a href="dectr.html#cb27-11"></a>                <span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">0</span>,<span class="dv">7</span>), <span class="dv">3</span>, <span class="dv">7</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb27-12"><a href="dectr.html#cb27-12"></a></span>
<span id="cb27-13"><a href="dectr.html#cb27-13"></a>grad &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>))</span>
<span id="cb27-14"><a href="dectr.html#cb27-14"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb27-15"><a href="dectr.html#cb27-15"></a></span>
<span id="cb27-16"><a href="dectr.html#cb27-16"></a>limited_data2&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]</span>
<span id="cb27-17"><a href="dectr.html#cb27-17"></a>limited_data3&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]</span>
<span id="cb27-18"><a href="dectr.html#cb27-18"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb27-19"><a href="dectr.html#cb27-19"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>)</span>
<span id="cb27-20"><a href="dectr.html#cb27-20"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb27-21"><a href="dectr.html#cb27-21"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb27-22"><a href="dectr.html#cb27-22"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">610</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb27-23"><a href="dectr.html#cb27-23"></a></span>
<span id="cb27-24"><a href="dectr.html#cb27-24"></a></span>
<span id="cb27-25"><a href="dectr.html#cb27-25"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb27-26"><a href="dectr.html#cb27-26"></a></span>
<span id="cb27-27"><a href="dectr.html#cb27-27"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb27-28"><a href="dectr.html#cb27-28"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb27-29"><a href="dectr.html#cb27-29"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb27-30"><a href="dectr.html#cb27-30"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb27-31"><a href="dectr.html#cb27-31"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">480</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb27-32"><a href="dectr.html#cb27-32"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb27-33"><a href="dectr.html#cb27-33"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb27-34"><a href="dectr.html#cb27-34"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;abeta&gt;=610&quot;</span>)</span>
<span id="cb27-35"><a href="dectr.html#cb27-35"></a></span>
<span id="cb27-36"><a href="dectr.html#cb27-36"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb27-37"><a href="dectr.html#cb27-37"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="dv">475</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb27-38"><a href="dectr.html#cb27-38"></a></span>
<span id="cb27-39"><a href="dectr.html#cb27-39"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb27-40"><a href="dectr.html#cb27-40"></a><span class="kw">plot</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,variableIndex],limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb27-41"><a href="dectr.html#cb27-41"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;abeta&lt;480&quot;</span>)</span>
<span id="cb27-42"><a href="dectr.html#cb27-42"></a></span>
<span id="cb27-43"><a href="dectr.html#cb27-43"></a>vps4 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb27-44"><a href="dectr.html#cb27-44"></a></span>
<span id="cb27-45"><a href="dectr.html#cb27-45"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb27-46"><a href="dectr.html#cb27-46"></a><span class="kw">plot</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,variableIndex],limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb27-47"><a href="dectr.html#cb27-47"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;abeta&gt;=480&quot;</span>)</span>
<span id="cb27-48"><a href="dectr.html#cb27-48"></a></span>
<span id="cb27-49"><a href="dectr.html#cb27-49"></a>vps5 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb27-50"><a href="dectr.html#cb27-50"></a></span>
<span id="cb27-51"><a href="dectr.html#cb27-51"></a></span>
<span id="cb27-52"><a href="dectr.html#cb27-52"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb27-53"><a href="dectr.html#cb27-53"></a><span class="kw">plot</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,variableIndex],limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb27-54"><a href="dectr.html#cb27-54"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;t-tau&lt;480&quot;</span>)</span>
<span id="cb27-55"><a href="dectr.html#cb27-55"></a></span>
<span id="cb27-56"><a href="dectr.html#cb27-56"></a>vps6 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb27-57"><a href="dectr.html#cb27-57"></a></span>
<span id="cb27-58"><a href="dectr.html#cb27-58"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb27-59"><a href="dectr.html#cb27-59"></a><span class="kw">plot</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,variableIndex],limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb27-60"><a href="dectr.html#cb27-60"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;t-tau&gt;=480&quot;</span>)</span>
<span id="cb27-61"><a href="dectr.html#cb27-61"></a></span>
<span id="cb27-62"><a href="dectr.html#cb27-62"></a>vps7 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb27-63"><a href="dectr.html#cb27-63"></a></span>
<span id="cb27-64"><a href="dectr.html#cb27-64"></a></span>
<span id="cb27-65"><a href="dectr.html#cb27-65"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb27-66"><a href="dectr.html#cb27-66"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb27-67"><a href="dectr.html#cb27-67"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb27-68"><a href="dectr.html#cb27-68"></a></span>
<span id="cb27-69"><a href="dectr.html#cb27-69"></a></span>
<span id="cb27-70"><a href="dectr.html#cb27-70"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb27-71"><a href="dectr.html#cb27-71"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb27-72"><a href="dectr.html#cb27-72"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb27-73"><a href="dectr.html#cb27-73"></a></span>
<span id="cb27-74"><a href="dectr.html#cb27-74"></a></span>
<span id="cb27-75"><a href="dectr.html#cb27-75"></a></span>
<span id="cb27-76"><a href="dectr.html#cb27-76"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb27-77"><a href="dectr.html#cb27-77"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps4, </span>
<span id="cb27-78"><a href="dectr.html#cb27-78"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb27-79"><a href="dectr.html#cb27-79"></a></span>
<span id="cb27-80"><a href="dectr.html#cb27-80"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb27-81"><a href="dectr.html#cb27-81"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps5, </span>
<span id="cb27-82"><a href="dectr.html#cb27-82"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb27-83"><a href="dectr.html#cb27-83"></a></span>
<span id="cb27-84"><a href="dectr.html#cb27-84"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb27-85"><a href="dectr.html#cb27-85"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps6, </span>
<span id="cb27-86"><a href="dectr.html#cb27-86"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb27-87"><a href="dectr.html#cb27-87"></a></span>
<span id="cb27-88"><a href="dectr.html#cb27-88"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb27-89"><a href="dectr.html#cb27-89"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps7, </span>
<span id="cb27-90"><a href="dectr.html#cb27-90"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups21"></span>
<img src="_main_files/figure-html/fig-groups21-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480." width="1440" />
<p class="caption">
Figure 3.22: The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480.
</p>
</div>
<p>Now we have to predict the MMT score for a patient with <span class="math inline">\(A\beta=1080\)</span> and t-tau=350. We start from the root.
The root tells us to go to the left if <span class="math inline">\(A\beta\)</span> is less than 610 otherwise go to the right. Our <span class="math inline">\(A\beta\)</span> is 1080 so we go to the right. Now the tree tells us to go to the left if t-tau is less than 480 which is the case for our patient. We go to the left and end up in a leaf node. What is the predicted MMT score? It is simply the average of all the MMT scores in that leaf: 28.3888889. In this case, i know the true value of the MMT for that patient: 30. This is the path we have been going through:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="dectr.html#cb28-1"></a><span class="co"># Select variable</span></span>
<span id="cb28-2"><a href="dectr.html#cb28-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb28-3"><a href="dectr.html#cb28-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb28-4"><a href="dectr.html#cb28-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb28-5"><a href="dectr.html#cb28-5"></a></span>
<span id="cb28-6"><a href="dectr.html#cb28-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb28-7"><a href="dectr.html#cb28-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb28-8"><a href="dectr.html#cb28-8"></a></span>
<span id="cb28-9"><a href="dectr.html#cb28-9"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb28-10"><a href="dectr.html#cb28-10"></a>                <span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,</span>
<span id="cb28-11"><a href="dectr.html#cb28-11"></a>                <span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">0</span>,<span class="dv">7</span>), <span class="dv">3</span>, <span class="dv">7</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb28-12"><a href="dectr.html#cb28-12"></a></span>
<span id="cb28-13"><a href="dectr.html#cb28-13"></a>grad &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&#39;red&#39;</span>,<span class="st">&#39;blue&#39;</span>))</span>
<span id="cb28-14"><a href="dectr.html#cb28-14"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb28-15"><a href="dectr.html#cb28-15"></a></span>
<span id="cb28-16"><a href="dectr.html#cb28-16"></a>limited_data2&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]</span>
<span id="cb28-17"><a href="dectr.html#cb28-17"></a>limited_data3&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]</span>
<span id="cb28-18"><a href="dectr.html#cb28-18"></a><span class="kw">plot</span>(limited_data[,variableIndex],limited_data[,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb28-19"><a href="dectr.html#cb28-19"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>)</span>
<span id="cb28-20"><a href="dectr.html#cb28-20"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb28-21"><a href="dectr.html#cb28-21"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb28-22"><a href="dectr.html#cb28-22"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">610</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb28-23"><a href="dectr.html#cb28-23"></a></span>
<span id="cb28-24"><a href="dectr.html#cb28-24"></a></span>
<span id="cb28-25"><a href="dectr.html#cb28-25"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb28-26"><a href="dectr.html#cb28-26"></a></span>
<span id="cb28-27"><a href="dectr.html#cb28-27"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb28-28"><a href="dectr.html#cb28-28"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb28-29"><a href="dectr.html#cb28-29"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb28-30"><a href="dectr.html#cb28-30"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb28-31"><a href="dectr.html#cb28-31"></a><span class="kw">abline</span>(<span class="dt">v=</span><span class="dv">480</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb28-32"><a href="dectr.html#cb28-32"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb28-33"><a href="dectr.html#cb28-33"></a><span class="kw">plot</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex],limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb28-34"><a href="dectr.html#cb28-34"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;abeta&gt;=610&quot;</span>)</span>
<span id="cb28-35"><a href="dectr.html#cb28-35"></a></span>
<span id="cb28-36"><a href="dectr.html#cb28-36"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb28-37"><a href="dectr.html#cb28-37"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="dv">475</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb28-38"><a href="dectr.html#cb28-38"></a></span>
<span id="cb28-39"><a href="dectr.html#cb28-39"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb28-40"><a href="dectr.html#cb28-40"></a><span class="kw">plot</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,variableIndex],limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb28-41"><a href="dectr.html#cb28-41"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;abeta&lt;480&quot;</span>)</span>
<span id="cb28-42"><a href="dectr.html#cb28-42"></a></span>
<span id="cb28-43"><a href="dectr.html#cb28-43"></a>vps4 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb28-44"><a href="dectr.html#cb28-44"></a></span>
<span id="cb28-45"><a href="dectr.html#cb28-45"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb28-46"><a href="dectr.html#cb28-46"></a><span class="kw">plot</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,variableIndex],limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb28-47"><a href="dectr.html#cb28-47"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;abeta&gt;=480&quot;</span>)</span>
<span id="cb28-48"><a href="dectr.html#cb28-48"></a></span>
<span id="cb28-49"><a href="dectr.html#cb28-49"></a>vps5 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb28-50"><a href="dectr.html#cb28-50"></a></span>
<span id="cb28-51"><a href="dectr.html#cb28-51"></a></span>
<span id="cb28-52"><a href="dectr.html#cb28-52"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb28-53"><a href="dectr.html#cb28-53"></a><span class="kw">plot</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,variableIndex],limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb28-54"><a href="dectr.html#cb28-54"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;t-tau&lt;480&quot;</span>)</span>
<span id="cb28-55"><a href="dectr.html#cb28-55"></a></span>
<span id="cb28-56"><a href="dectr.html#cb28-56"></a>vps6 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb28-57"><a href="dectr.html#cb28-57"></a></span>
<span id="cb28-58"><a href="dectr.html#cb28-58"></a>colors&lt;-<span class="kw">grad</span>(<span class="dv">10</span>)[<span class="kw">as.numeric</span>(<span class="kw">cut</span>(limited_data[limited_data<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,]<span class="op">$</span>mmt,<span class="dt">breaks =</span> <span class="dv">10</span>))]</span>
<span id="cb28-59"><a href="dectr.html#cb28-59"></a><span class="kw">plot</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,variableIndex],limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,variableIndex2],<span class="dt">xlab =</span>variableIndex,<span class="dt">ylab =</span> variableIndex2,</span>
<span id="cb28-60"><a href="dectr.html#cb28-60"></a>    <span class="dt">col=</span>colors,<span class="dt">pch=</span><span class="dv">15</span>,<span class="dt">main=</span><span class="st">&quot;t-tau&gt;=480&quot;</span>)</span>
<span id="cb28-61"><a href="dectr.html#cb28-61"></a></span>
<span id="cb28-62"><a href="dectr.html#cb28-62"></a>vps7 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb28-63"><a href="dectr.html#cb28-63"></a></span>
<span id="cb28-64"><a href="dectr.html#cb28-64"></a></span>
<span id="cb28-65"><a href="dectr.html#cb28-65"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb28-66"><a href="dectr.html#cb28-66"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb28-67"><a href="dectr.html#cb28-67"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>))</span>
<span id="cb28-68"><a href="dectr.html#cb28-68"></a></span>
<span id="cb28-69"><a href="dectr.html#cb28-69"></a></span>
<span id="cb28-70"><a href="dectr.html#cb28-70"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb28-71"><a href="dectr.html#cb28-71"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb28-72"><a href="dectr.html#cb28-72"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb28-73"><a href="dectr.html#cb28-73"></a></span>
<span id="cb28-74"><a href="dectr.html#cb28-74"></a></span>
<span id="cb28-75"><a href="dectr.html#cb28-75"></a></span>
<span id="cb28-76"><a href="dectr.html#cb28-76"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb28-77"><a href="dectr.html#cb28-77"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps4, </span>
<span id="cb28-78"><a href="dectr.html#cb28-78"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb28-79"><a href="dectr.html#cb28-79"></a></span>
<span id="cb28-80"><a href="dectr.html#cb28-80"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb28-81"><a href="dectr.html#cb28-81"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps5, </span>
<span id="cb28-82"><a href="dectr.html#cb28-82"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb28-83"><a href="dectr.html#cb28-83"></a></span>
<span id="cb28-84"><a href="dectr.html#cb28-84"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb28-85"><a href="dectr.html#cb28-85"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps6, </span>
<span id="cb28-86"><a href="dectr.html#cb28-86"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>))</span>
<span id="cb28-87"><a href="dectr.html#cb28-87"></a></span>
<span id="cb28-88"><a href="dectr.html#cb28-88"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb28-89"><a href="dectr.html#cb28-89"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps7, </span>
<span id="cb28-90"><a href="dectr.html#cb28-90"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups22"></span>
<img src="_main_files/figure-html/fig-groups22-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480. Tha path is show by blue lines between the plots" width="1440" />
<p class="caption">
Figure 3.23: The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480. Tha path is show by blue lines between the plots
</p>
</div>
<p>Alright. We now know how to build a decision tree and how to do predictions. But there is one more thing to know before going ahead. That is when do we stop growing the tree. If we really continue splitting the variables, in the end, we end up with a tree that has a leaf for each patient. When the tree is very large, it is more likely that it will capture noise instead of a global pattern of the data. In this case, we say that the tree is overfitted. Fortunately, there are ways to avoid that to some extent and they are called pruning methods.</p>
</div>
<div id="pre-pruning" class="section level2">
<h2><span class="header-section-number">3.4</span> Pre-pruning</h2>
<p>Pre-pruning refers to a situation that at every single split we check a set of criteria telling us whether this split is allowed or now. For example, we could set that we want the minimum number of samples in each node or leaf to be 5. In this case, if a split leading to a leaf with less than 5 samples will be ignored. Another rule is to set the maximum size of the tree which obviously prevents the tree from growing beyond that size. Another criterion is to stop spiting a node if the improvement in purity or variance does not reach a pre-defined value. All of these methods can be set in most of the software packages such as <strong>rpart</strong> or <strong>tree</strong>.</p>
<p>As an example, look at our previous tree:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="dectr.html#cb29-1"></a><span class="co"># Select variable</span></span>
<span id="cb29-2"><a href="dectr.html#cb29-2"></a>variableIndex&lt;-<span class="st">&quot;abeta&quot;</span></span>
<span id="cb29-3"><a href="dectr.html#cb29-3"></a>variableIndex2&lt;-<span class="st">&quot;t_tau&quot;</span></span>
<span id="cb29-4"><a href="dectr.html#cb29-4"></a><span class="co"># plot the data for both of the variables</span></span>
<span id="cb29-5"><a href="dectr.html#cb29-5"></a></span>
<span id="cb29-6"><a href="dectr.html#cb29-6"></a><span class="kw">library</span>(grid)      <span class="co">## &lt;-- My addition</span></span>
<span id="cb29-7"><a href="dectr.html#cb29-7"></a><span class="kw">library</span>(gridBase)  <span class="co">## &lt;-- My addition</span></span>
<span id="cb29-8"><a href="dectr.html#cb29-8"></a></span>
<span id="cb29-9"><a href="dectr.html#cb29-9"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb29-10"><a href="dectr.html#cb29-10"></a>                <span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">0</span>,</span>
<span id="cb29-11"><a href="dectr.html#cb29-11"></a>                <span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>,<span class="dv">6</span>,<span class="dv">0</span>,<span class="dv">7</span>), <span class="dv">3</span>, <span class="dv">7</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>))</span>
<span id="cb29-12"><a href="dectr.html#cb29-12"></a></span>
<span id="cb29-13"><a href="dectr.html#cb29-13"></a>limited_data2&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]</span>
<span id="cb29-14"><a href="dectr.html#cb29-14"></a>limited_data3&lt;-limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]</span>
<span id="cb29-15"><a href="dectr.html#cb29-15"></a></span>
<span id="cb29-16"><a href="dectr.html#cb29-16"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb29-17"><a href="dectr.html#cb29-17"></a></span>
<span id="cb29-18"><a href="dectr.html#cb29-18"></a>usr1 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb29-19"><a href="dectr.html#cb29-19"></a>vps1 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb29-20"><a href="dectr.html#cb29-20"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">610</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;abeta&lt;610&quot;</span>)</span>
<span id="cb29-21"><a href="dectr.html#cb29-21"></a>usr2 &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)</span>
<span id="cb29-22"><a href="dectr.html#cb29-22"></a>vps2 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb29-23"><a href="dectr.html#cb29-23"></a></span>
<span id="cb29-24"><a href="dectr.html#cb29-24"></a></span>
<span id="cb29-25"><a href="dectr.html#cb29-25"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data[limited_data<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">610</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=610&quot;</span>)</span>
<span id="cb29-26"><a href="dectr.html#cb29-26"></a>vps3 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb29-27"><a href="dectr.html#cb29-27"></a></span>
<span id="cb29-28"><a href="dectr.html#cb29-28"></a></span>
<span id="cb29-29"><a href="dectr.html#cb29-29"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&lt;</span><span class="dv">480</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;abeta&lt;480&quot;</span>)</span>
<span id="cb29-30"><a href="dectr.html#cb29-30"></a></span>
<span id="cb29-31"><a href="dectr.html#cb29-31"></a>vps4 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb29-32"><a href="dectr.html#cb29-32"></a></span>
<span id="cb29-33"><a href="dectr.html#cb29-33"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data2[limited_data2<span class="op">$</span>abeta<span class="op">&gt;=</span><span class="dv">480</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;abeta&gt;=480&quot;</span>)</span>
<span id="cb29-34"><a href="dectr.html#cb29-34"></a>vps5 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb29-35"><a href="dectr.html#cb29-35"></a></span>
<span id="cb29-36"><a href="dectr.html#cb29-36"></a></span>
<span id="cb29-37"><a href="dectr.html#cb29-37"></a></span>
<span id="cb29-38"><a href="dectr.html#cb29-38"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&lt;</span><span class="dv">475</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;t-tau&lt;480&quot;</span>)</span>
<span id="cb29-39"><a href="dectr.html#cb29-39"></a></span>
<span id="cb29-40"><a href="dectr.html#cb29-40"></a>vps6 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb29-41"><a href="dectr.html#cb29-41"></a></span>
<span id="cb29-42"><a href="dectr.html#cb29-42"></a></span>
<span id="cb29-43"><a href="dectr.html#cb29-43"></a><span class="kw">barplot</span>(<span class="kw">prop.table</span>(<span class="kw">table</span>(limited_data3[limited_data3<span class="op">$</span>t_tau<span class="op">&gt;=</span><span class="dv">475</span>,]<span class="op">$</span>group)),<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">main=</span><span class="st">&quot;t-tau&gt;=480&quot;</span>)</span>
<span id="cb29-44"><a href="dectr.html#cb29-44"></a></span>
<span id="cb29-45"><a href="dectr.html#cb29-45"></a>vps7 &lt;-<span class="st"> </span><span class="kw">do.call</span>(vpStack, <span class="kw">baseViewports</span>())</span>
<span id="cb29-46"><a href="dectr.html#cb29-46"></a></span>
<span id="cb29-47"><a href="dectr.html#cb29-47"></a></span>
<span id="cb29-48"><a href="dectr.html#cb29-48"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb29-49"><a href="dectr.html#cb29-49"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps3, </span>
<span id="cb29-50"><a href="dectr.html#cb29-50"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-51"><a href="dectr.html#cb29-51"></a></span>
<span id="cb29-52"><a href="dectr.html#cb29-52"></a></span>
<span id="cb29-53"><a href="dectr.html#cb29-53"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps1)</span>
<span id="cb29-54"><a href="dectr.html#cb29-54"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps2, </span>
<span id="cb29-55"><a href="dectr.html#cb29-55"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-56"><a href="dectr.html#cb29-56"></a></span>
<span id="cb29-57"><a href="dectr.html#cb29-57"></a></span>
<span id="cb29-58"><a href="dectr.html#cb29-58"></a></span>
<span id="cb29-59"><a href="dectr.html#cb29-59"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb29-60"><a href="dectr.html#cb29-60"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps4, </span>
<span id="cb29-61"><a href="dectr.html#cb29-61"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-62"><a href="dectr.html#cb29-62"></a></span>
<span id="cb29-63"><a href="dectr.html#cb29-63"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps2)</span>
<span id="cb29-64"><a href="dectr.html#cb29-64"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps5, </span>
<span id="cb29-65"><a href="dectr.html#cb29-65"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-66"><a href="dectr.html#cb29-66"></a></span>
<span id="cb29-67"><a href="dectr.html#cb29-67"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb29-68"><a href="dectr.html#cb29-68"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps6, </span>
<span id="cb29-69"><a href="dectr.html#cb29-69"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-70"><a href="dectr.html#cb29-70"></a></span>
<span id="cb29-71"><a href="dectr.html#cb29-71"></a><span class="kw">grid.move.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="fl">-0.4</span>, <span class="dt">vp =</span> vps3)</span>
<span id="cb29-72"><a href="dectr.html#cb29-72"></a><span class="kw">grid.line.to</span>(<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">y =</span> <span class="kw">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="dt">vp =</span> vps7, </span>
<span id="cb29-73"><a href="dectr.html#cb29-73"></a>             <span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-74"><a href="dectr.html#cb29-74"></a></span>
<span id="cb29-75"><a href="dectr.html#cb29-75"></a><span class="kw">grid.text</span>(<span class="st">&quot;AD&quot;</span>,<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">y=</span><span class="kw">unit</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">vp=</span>vps4,<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-76"><a href="dectr.html#cb29-76"></a><span class="kw">grid.text</span>(<span class="st">&quot;AD&quot;</span>,<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">y=</span><span class="kw">unit</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">vp=</span>vps5,<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-77"><a href="dectr.html#cb29-77"></a><span class="kw">grid.text</span>(<span class="st">&quot;Control&quot;</span>,<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">y=</span><span class="kw">unit</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">vp=</span>vps6,<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>))</span>
<span id="cb29-78"><a href="dectr.html#cb29-78"></a><span class="kw">grid.text</span>(<span class="st">&quot;Control&quot;</span>,<span class="dt">x =</span> <span class="kw">unit</span>(<span class="fl">0.5</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">y=</span><span class="kw">unit</span>(<span class="op">-</span><span class="fl">0.25</span>, <span class="st">&quot;npc&quot;</span>),<span class="dt">vp=</span>vps7,<span class="dt">gp =</span> <span class="kw">gpar</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups23"></span>
<img src="_main_files/figure-html/fig-groups23-1.png" alt="The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480." width="1440" />
<p class="caption">
Figure 3.24: The example of two variables measured on a number of samples. Cut on abeta=610 and abeta=480.
</p>
</div>
<p>We see that the first two leaves on the left are both showing that AD is a major class. So maybe they are not needed. Instead, we could just stop at <span class="math inline">\(A\beta&lt;610\)</span> and assign every sample landing there as AD. There is however a big problem here. The tree generating methods are often greedy or short-sighted. This means that at each node, they only care about a single next move. They really don’t deal with what will happen after 10 splits from now. As a result, the tree does not know that there is a chance that a variable that is now being ignored might come up as important later down the tree. Post-pruning methods deal with that situation!</p>
</div>
<div id="post-pruning" class="section level2">
<h2><span class="header-section-number">3.5</span> Post-pruning</h2>
<p>Post-pruning lets us grow the tree as much as we want but after the building is over it goes through the tree and prunes off the branches that are either redundant or might give us an overfitting problem. There are multiple methods for doing that. We will go through one of the most popular ones that is called “Weakest-Link Cutting”. Before going forward we will have to introduce some math notations so it will be easier to follow the rest.</p>
<p>Similar to other machine learning techniques, decision trees can also be thought to optimize a function. For example, in the case of classification, we can say that we want to minimize the misclassification error rate. We define misclassification of a single node on the training data by:</p>
<p><span class="math display">\[R(t)=(1-max_j\frac{N_j(t)}{N(t)})\times \frac{N(t)}{N}\]</span></p>
<p>where <span class="math inline">\(max_j\)</span> denote the class <span class="math inline">\(j\)</span> which has the majority of the memory of that node. <span class="math inline">\(N_j(t)\)</span> is the number of members with class <span class="math inline">\(j\)</span> at node <span class="math inline">\(t\)</span>. <span class="math inline">\(N(t)\)</span> is the total number of samples at node <span class="math inline">\(t\)</span> and <span class="math inline">\(N\)</span> is the total number of samples in each dataset. Please remember that that <span class="math inline">\(R(t)\)</span> only concerns a node without considering the leaves.</p>
<p>For a tree or a subtree, we define:</p>
<p><span class="math display">\[R(T_k)=\sum_{t\in\tilde{T_k}}{R(t)}\]</span></p>
<p>where <span class="math inline">\(\tilde{T}\)</span> is the set of leaves of the subtree root that <span class="math inline">\(k\)</span>.</p>
<p>What <span class="math inline">\(R(t)\)</span> tells you is that for any node, if you want to calculate the training error rate, calculate 1 minus the total number of samples with majority classes divide by the total number of samples at this node. Then weigh the whole thing by the proportion of the samples going to that node. For example, if I have data set with 20 samples where 10 of them are AD and the rest control. Then I make a decision tree giving me a node with 5 AD and 3 controls. The <span class="math inline">\(R(t)\)</span> of that node becomes <span class="math inline">\((1-\frac{5}{8})\times\frac{8}{20}=0.15\)</span>.</p>
<p>For calculating the <span class="math inline">\(R(T_k)\)</span>, imagine i have a tree that looks like this:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="dectr.html#cb30-1"></a><span class="kw">library</span>(DiagrammeR)</span>
<span id="cb30-2"><a href="dectr.html#cb30-2"></a></span>
<span id="cb30-3"><a href="dectr.html#cb30-3"></a>nodes &lt;-<span class="st"> </span><span class="kw">create_node_df</span>(<span class="dt">n =</span> <span class="dv">7</span>, <span class="dt">type =</span> <span class="st">&quot;number&quot;</span>,<span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;1&quot;</span>,<span class="st">&quot;2&quot;</span>,<span class="st">&quot;3&quot;</span>,<span class="st">&quot;4</span><span class="ch">\n</span><span class="st">AD:3&quot;</span>,<span class="st">&quot;5</span><span class="ch">\n</span><span class="st">AD:1</span><span class="ch">\n</span><span class="st">C:5&quot;</span>,<span class="st">&quot;6</span><span class="ch">\n</span><span class="st">AD:1</span><span class="ch">\n</span><span class="st">C:2&quot;</span>,<span class="st">&quot;7</span><span class="ch">\n</span><span class="st">AD:5</span><span class="ch">\n</span><span class="st">C:3&quot;</span>))</span>
<span id="cb30-4"><a href="dectr.html#cb30-4"></a></span>
<span id="cb30-5"><a href="dectr.html#cb30-5"></a>edges &lt;-<span class="st"> </span><span class="kw">create_edge_df</span>(<span class="dt">from =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb30-6"><a href="dectr.html#cb30-6"></a>                        <span class="dt">to =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb30-7"><a href="dectr.html#cb30-7"></a>                       <span class="dt">rel =</span> <span class="st">&quot;leading to&quot;</span>)</span>
<span id="cb30-8"><a href="dectr.html#cb30-8"></a></span>
<span id="cb30-9"><a href="dectr.html#cb30-9"></a>graph &lt;-<span class="st"> </span><span class="kw">create_graph</span>(<span class="dt">nodes_df =</span> nodes, <span class="dt">attr_theme =</span> <span class="st">&quot;tb&quot;</span>,</span>
<span id="cb30-10"><a href="dectr.html#cb30-10"></a>                      <span class="dt">edges_df =</span> edges, </span>
<span id="cb30-11"><a href="dectr.html#cb30-11"></a>                  ) </span>
<span id="cb30-12"><a href="dectr.html#cb30-12"></a></span>
<span id="cb30-13"><a href="dectr.html#cb30-13"></a><span class="kw">render_graph</span>(graph)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups24"></span>
<div id="htmlwidget-0cde89d9cd2e7a91b40b" style="width:480px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-0cde89d9cd2e7a91b40b">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       rankdir = \"TB\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"2\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"3\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"4\nAD:3\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"5\nAD:1\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"6\nAD:1\nC:2\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"7\nAD:5\nC:3\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n  \"2\"->\"4\" \n  \"2\"->\"5\" \n  \"3\"->\"6\" \n  \"3\"->\"7\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.25: The example of an imaginary decision tree
</p>
</div>
<p>Let say I want to calculate <span class="math inline">\(R(T_3)\)</span> which means i want to find misclassification rate for the subtree starting from node <span class="math inline">\(3\)</span>. The subtree has two leaves <span class="math inline">\(6\)</span> and <span class="math inline">\(7\)</span>.
I will start with the <span class="math inline">\(6\)</span> and calculate <span class="math inline">\(R(6)=(1-\frac{2}{3})\times\frac{3}{20}=0.049\)</span> and i do it for the right branch also <span class="math inline">\(R(7)=(1-\frac{5}{8})\times\frac{8}{20}=0.15\)</span>. For calculating <span class="math inline">\(R(T_3)\)</span> i simply add up <span class="math inline">\(0.049\)</span> and <span class="math inline">\(0.15\)</span> so <span class="math inline">\(R(T_3)=0.2\)</span></p>
<p>At this stage, we have to introduce our penalty term into <span class="math inline">\(R(T)\)</span> so it becomes:
<span class="math display">\[R_{\alpha}(T)=R(T)+\alpha.|\tilde{T}|\]</span>
where alpha is our complexity parameter and <span class="math inline">\(|\tilde{T}|\)</span> is the total number of leaf nodes in the tree. What this equation tells us is that, as we grow a bigger and bigger tree with a lot of leaf nodes, our misclassification error rate will increase. We should tune the cost complexity parameter to give us a good minimum <span class="math inline">\(R_{\alpha}(T)\)</span>. How how do we tune this? Weakest-Link Cutting is a method for doing that. As the name suggests we will have to identify the “weakest link” subtree in the whole tree and that is given by a subtree which the minimum of</p>
<p><span class="math display">\[g(t)\left\{\begin{matrix}\frac{R(t)-R(T_t)}{|\tilde{T}_t|-1}, &amp; t \notin \tilde{T}_t \\ +\infty, &amp; t \in \tilde{T}_t\end{matrix}\right.\]</span></p>
<p>What this is telling us is that for a subtree rooting at node <span class="math inline">\(t\)</span> we can calculate <span class="math inline">\(g(t)\)</span> but subtracting the error rate of the <em>node</em> (<span class="math inline">\(R(t)\)</span>) by the total error rate of its leaf nodes (<span class="math inline">\(R(T_t)\)</span>) divided by the total number of its leaf node minus one (if <span class="math inline">\(t\)</span> is not a lead node itself, otherwise it becomes infinity). Let’s see how we use this in practice. Look at the previous example:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="dectr.html#cb31-1"></a><span class="kw">library</span>(DiagrammeR)</span>
<span id="cb31-2"><a href="dectr.html#cb31-2"></a></span>
<span id="cb31-3"><a href="dectr.html#cb31-3"></a>nodes &lt;-<span class="st"> </span><span class="kw">create_node_df</span>(<span class="dt">n =</span> <span class="dv">7</span>, <span class="dt">type =</span> <span class="st">&quot;number&quot;</span>,<span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;1</span><span class="ch">\n</span><span class="st">AD:10</span><span class="ch">\n</span><span class="st">C:10&quot;</span>,<span class="st">&quot;2</span><span class="ch">\n</span><span class="st">AD:4</span><span class="ch">\n</span><span class="st">C:5&quot;</span>,<span class="st">&quot;3</span><span class="ch">\n</span><span class="st">AD:6</span><span class="ch">\n</span><span class="st">C:5&quot;</span>,<span class="st">&quot;4</span><span class="ch">\n</span><span class="st">AD:3&quot;</span>,<span class="st">&quot;5</span><span class="ch">\n</span><span class="st">AD:1</span><span class="ch">\n</span><span class="st">C:5&quot;</span>,<span class="st">&quot;6</span><span class="ch">\n</span><span class="st">AD:1</span><span class="ch">\n</span><span class="st">C:2&quot;</span>,<span class="st">&quot;7</span><span class="ch">\n</span><span class="st">AD:5</span><span class="ch">\n</span><span class="st">C:3&quot;</span>))</span>
<span id="cb31-4"><a href="dectr.html#cb31-4"></a></span>
<span id="cb31-5"><a href="dectr.html#cb31-5"></a>edges &lt;-<span class="st"> </span><span class="kw">create_edge_df</span>(<span class="dt">from =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb31-6"><a href="dectr.html#cb31-6"></a>                        <span class="dt">to =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb31-7"><a href="dectr.html#cb31-7"></a>                       <span class="dt">rel =</span> <span class="st">&quot;leading to&quot;</span>)</span>
<span id="cb31-8"><a href="dectr.html#cb31-8"></a></span>
<span id="cb31-9"><a href="dectr.html#cb31-9"></a>graph &lt;-<span class="st"> </span><span class="kw">create_graph</span>(<span class="dt">nodes_df =</span> nodes, <span class="dt">attr_theme =</span> <span class="st">&quot;tb&quot;</span>,</span>
<span id="cb31-10"><a href="dectr.html#cb31-10"></a>                      <span class="dt">edges_df =</span> edges, </span>
<span id="cb31-11"><a href="dectr.html#cb31-11"></a>                  ) </span>
<span id="cb31-12"><a href="dectr.html#cb31-12"></a></span>
<span id="cb31-13"><a href="dectr.html#cb31-13"></a><span class="kw">render_graph</span>(graph)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups25"></span>
<div id="htmlwidget-0b5d79737a4f07e4f9b0" style="width:480px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-0b5d79737a4f07e4f9b0">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       rankdir = \"TB\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\nAD:10\nC:10\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"2\nAD:4\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"3\nAD:6\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"4\nAD:3\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"5\nAD:1\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"6\" [label = \"6\nAD:1\nC:2\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"7\" [label = \"7\nAD:5\nC:3\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n  \"2\"->\"4\" \n  \"2\"->\"5\" \n  \"3\"->\"6\" \n  \"3\"->\"7\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.26: The example of an imaginary decision tree. AD: Alzheimers disease and C: control. We call this T1
</p>
</div>
<p>As you see, we have three nodes that are not leaf nodes (1,2, and 3). For each of these nodes we calculate their <span class="math inline">\(g(t)\)</span>:</p>
<p>Let’s start with the first node and set <span class="math inline">\(\alpha_1=0\)</span>:
<span class="math display">\[R(T_1)=((1-\frac{3}{3})\times \frac{3}{20})+((1-\frac{5}{6})\times \frac{6}{20})+((1-\frac{2}{3})\times \frac{3}{20})+((1-\frac{5}{8})\times \frac{8}{20})=0.25\]</span></p>
<p><span class="math display">\[R(1)=(1-\frac{10}{20})\times\frac{20}{20}=0.5\]</span>
<span class="math display">\[g(1)=\frac{0.5-0.25}{4-1}=0.083\]</span>
We now do the same for node 2:</p>
<p><span class="math display">\[R(T_2)=((1-\frac{3}{3})\times \frac{3}{20})+((1-\frac{5}{6})\times \frac{6}{20})=0.05\]</span></p>
<p><span class="math display">\[R(2)=(1-\frac{4}{9})\times\frac{9}{20}=0.25\]</span>
<span class="math display">\[g(2)=\frac{0.2-0.05}{2-1}=0.15\]</span>
And finally for node 3:
<span class="math display">\[R(T_3)=((1-\frac{2}{3})\times \frac{3}{20})+((1-\frac{5}{8})\times \frac{8}{20})=0.2\]</span></p>
<p><span class="math display">\[R(3)=(1-\frac{6}{11})\times\frac{11}{20}=0.25\]</span>
<span class="math display">\[g(3)=\frac{0.25-0.2}{2-1}=0.05\]</span>
So we have <span class="math inline">\(g(1)=0.083\)</span>, <span class="math inline">\(g(2)=0.15\)</span>, and <span class="math inline">\(g(3)=0.05\)</span>. We see that <span class="math inline">\(g(3)\)</span> is the minimum so the weakest link. we will prune at node 3. So our tree becomes:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="dectr.html#cb32-1"></a><span class="kw">library</span>(DiagrammeR)</span>
<span id="cb32-2"><a href="dectr.html#cb32-2"></a></span>
<span id="cb32-3"><a href="dectr.html#cb32-3"></a>nodes &lt;-<span class="st"> </span><span class="kw">create_node_df</span>(<span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">type =</span> <span class="st">&quot;number&quot;</span>,<span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;1</span><span class="ch">\n</span><span class="st">AD:10</span><span class="ch">\n</span><span class="st">C:10&quot;</span>,<span class="st">&quot;2</span><span class="ch">\n</span><span class="st">AD:4</span><span class="ch">\n</span><span class="st">C:5&quot;</span>,<span class="st">&quot;3</span><span class="ch">\n</span><span class="st">AD:6</span><span class="ch">\n</span><span class="st">C:5&quot;</span>,<span class="st">&quot;4</span><span class="ch">\n</span><span class="st">AD:3&quot;</span>,<span class="st">&quot;5</span><span class="ch">\n</span><span class="st">AD:1</span><span class="ch">\n</span><span class="st">C:5&quot;</span>))</span>
<span id="cb32-4"><a href="dectr.html#cb32-4"></a></span>
<span id="cb32-5"><a href="dectr.html#cb32-5"></a>edges &lt;-<span class="st"> </span><span class="kw">create_edge_df</span>(<span class="dt">from =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb32-6"><a href="dectr.html#cb32-6"></a>                        <span class="dt">to =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb32-7"><a href="dectr.html#cb32-7"></a>                       <span class="dt">rel =</span> <span class="st">&quot;leading to&quot;</span>)</span>
<span id="cb32-8"><a href="dectr.html#cb32-8"></a></span>
<span id="cb32-9"><a href="dectr.html#cb32-9"></a>graph &lt;-<span class="st"> </span><span class="kw">create_graph</span>(<span class="dt">nodes_df =</span> nodes, <span class="dt">attr_theme =</span> <span class="st">&quot;tb&quot;</span>,</span>
<span id="cb32-10"><a href="dectr.html#cb32-10"></a>                      <span class="dt">edges_df =</span> edges, </span>
<span id="cb32-11"><a href="dectr.html#cb32-11"></a>                  ) </span>
<span id="cb32-12"><a href="dectr.html#cb32-12"></a></span>
<span id="cb32-13"><a href="dectr.html#cb32-13"></a><span class="kw">render_graph</span>(graph)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups26"></span>
<div id="htmlwidget-866fd2916a745732508d" style="width:480px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-866fd2916a745732508d">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       rankdir = \"TB\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\nAD:10\nC:10\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"2\nAD:4\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"3\nAD:6\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"4\" [label = \"4\nAD:3\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"5\" [label = \"5\nAD:1\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n  \"2\"->\"4\" \n  \"2\"->\"5\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.27: The example of an imaginary decision tree. AD: Alzheimers disease and C: control. We call this T2
</p>
</div>
<p>Please note that the node 3 is now a leaf node. We set <span class="math inline">\(\alpha_2=g(3)=0.05\)</span> and continue with our new tree:</p>
<p><span class="math display">\[R(T_1)=((1-\frac{3}{3})\times \frac{3}{20})+((1-\frac{5}{6})\times \frac{6}{20})+((1-\frac{6}{11})\times \frac{11}{20})=0.3\]</span></p>
<p><span class="math display">\[R(1)=(1-\frac{10}{20})\times\frac{20}{20}=0.5\]</span></p>
<p><span class="math display">\[g(1)=\frac{0.5-0.3}{2-1}=0.2\]</span>
We now do the same for node 2:</p>
<p><span class="math display">\[R(T_2)=((1-\frac{3}{3})\times \frac{3}{20})+((1-\frac{5}{6})\times \frac{6}{20})=0.05\]</span></p>
<p><span class="math display">\[R(2)=(1-\frac{4}{9})\times\frac{9}{20}=0.25\]</span></p>
<p><span class="math display">\[g(2)=\frac{0.2-0.05}{2-1}=0.15\]</span>
So our <span class="math inline">\(g(2)\)</span> is the smallest. We do another pruning here:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="dectr.html#cb33-1"></a><span class="kw">library</span>(DiagrammeR)</span>
<span id="cb33-2"><a href="dectr.html#cb33-2"></a></span>
<span id="cb33-3"><a href="dectr.html#cb33-3"></a>nodes &lt;-<span class="st"> </span><span class="kw">create_node_df</span>(<span class="dt">n =</span> <span class="dv">3</span>, <span class="dt">type =</span> <span class="st">&quot;number&quot;</span>,<span class="dt">label =</span> <span class="kw">c</span>(<span class="st">&quot;1</span><span class="ch">\n</span><span class="st">AD:10</span><span class="ch">\n</span><span class="st">C:10&quot;</span>,<span class="st">&quot;2</span><span class="ch">\n</span><span class="st">AD:4</span><span class="ch">\n</span><span class="st">C:5&quot;</span>,<span class="st">&quot;3</span><span class="ch">\n</span><span class="st">AD:6</span><span class="ch">\n</span><span class="st">C:5&quot;</span>))</span>
<span id="cb33-4"><a href="dectr.html#cb33-4"></a></span>
<span id="cb33-5"><a href="dectr.html#cb33-5"></a>edges &lt;-<span class="st"> </span><span class="kw">create_edge_df</span>(<span class="dt">from =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb33-6"><a href="dectr.html#cb33-6"></a>                        <span class="dt">to =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb33-7"><a href="dectr.html#cb33-7"></a>                       <span class="dt">rel =</span> <span class="st">&quot;leading to&quot;</span>)</span>
<span id="cb33-8"><a href="dectr.html#cb33-8"></a></span>
<span id="cb33-9"><a href="dectr.html#cb33-9"></a>graph &lt;-<span class="st"> </span><span class="kw">create_graph</span>(<span class="dt">nodes_df =</span> nodes, <span class="dt">attr_theme =</span> <span class="st">&quot;tb&quot;</span>,</span>
<span id="cb33-10"><a href="dectr.html#cb33-10"></a>                      <span class="dt">edges_df =</span> edges, </span>
<span id="cb33-11"><a href="dectr.html#cb33-11"></a>                  ) </span>
<span id="cb33-12"><a href="dectr.html#cb33-12"></a></span>
<span id="cb33-13"><a href="dectr.html#cb33-13"></a><span class="kw">render_graph</span>(graph)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups27"></span>
<div id="htmlwidget-d8579d16083db861ee75" style="width:480px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-d8579d16083db861ee75">{"x":{"diagram":"digraph {\n\ngraph [layout = \"dot\",\n       rankdir = \"TB\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"1\nAD:10\nC:10\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"2\" [label = \"2\nAD:4\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"3\" [label = \"3\nAD:6\nC:5\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\"] \n  \"1\"->\"2\" \n  \"1\"->\"3\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 3.28: The example of an imaginary decision tree. AD: Alzheimers disease and C: control. We call this T3
</p>
</div>
<p>we now set <span class="math inline">\(\alpha_3=g(2)=0.15\)</span> and continue with our final node (the root):</p>
<p><span class="math display">\[R(T_1)=((1-\frac{5}{9})\times \frac{9}{20})+((1-\frac{6}{11})\times \frac{11}{20})=0.45\]</span></p>
<p><span class="math display">\[R(1)=(1-\frac{10}{20})\times\frac{20}{20}=0.5\]</span></p>
<p><span class="math display">\[g(1)=\frac{0.5-0.45}{2-1}=0.05\]</span>
So we set the <span class="math inline">\(\alpha_4=g(1)=0.05\)</span></p>
<p>At the end of this story, we have <span class="math inline">\(\alpha_1=0\)</span>, <span class="math inline">\(\alpha_2=0.05\)</span>, <span class="math inline">\(\alpha_3=0.15\)</span> and <span class="math inline">\(\alpha_4=0.05\)</span>.
Now we define rules for selecting the best tree:
If <span class="math inline">\(0\geq \alpha &lt;0.05\)</span> then we use our largest tree: T1.
If <span class="math inline">\(\alpha=0.05\)</span> then we can use T2.
If <span class="math inline">\(0.05&lt; \alpha &lt;0.15\)</span> we use T3.</p>
<p>The question is how do we select <span class="math inline">\(\alpha\)</span>? The answer is cross-validation. Let’s go through it briefly.</p>
</div>
<div id="cross-validation" class="section level2">
<h2><span class="header-section-number">3.6</span> Cross validation</h2>
<p>Cross-validation refers to various different ways to estimate whether a statistical model can generalize to an independent dataset. The reason that we do cross-validation is that statistical models tend to fit the data points so perfectly that instead of capturing a global pattern of interest in the data, they start following the noise associated with individual data points. As a result of capturing noise, they cannot perform well when we give them a new sample to predict.</p>
<p>Let’s have a look at an example where we want to predict t-tau based on p-tau:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="dectr.html#cb34-1"></a><span class="kw">plot</span>(limited_data<span class="op">$</span>p_tau,limited_data<span class="op">$</span>t_tau,<span class="dt">xlab =</span> <span class="st">&quot;p-tau&quot;</span>,<span class="dt">ylab =</span> <span class="st">&quot;t-tau&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups28"></span>
<img src="_main_files/figure-html/fig-groups28-1.png" alt="plot of p-tau vs t-tau. The data that will be used for validation is between the red lines" width="1440" />
<p class="caption">
Figure 3.29: plot of p-tau vs t-tau. The data that will be used for validation is between the red lines
</p>
</div>
<p>I will remove a chunk of the data randomly to be used for testing later. For the reaming data, i will fit a flexible regression model (LOESS) and one with less flexibility.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="dectr.html#cb35-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb35-2"><a href="dectr.html#cb35-2"></a><span class="kw">set.seed</span>(<span class="dv">20</span>)</span>
<span id="cb35-3"><a href="dectr.html#cb35-3"></a>testing_index&lt;-<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(limited_data<span class="op">$</span>p_tau),<span class="dv">50</span>,<span class="dt">replace =</span> F)</span>
<span id="cb35-4"><a href="dectr.html#cb35-4"></a></span>
<span id="cb35-5"><a href="dectr.html#cb35-5"></a>limited_data4_training&lt;-limited_data[<span class="op">-</span>testing_index,]</span>
<span id="cb35-6"><a href="dectr.html#cb35-6"></a>limited_data4_testing&lt;-limited_data[testing_index,]</span>
<span id="cb35-7"><a href="dectr.html#cb35-7"></a></span>
<span id="cb35-8"><a href="dectr.html#cb35-8"></a></span>
<span id="cb35-9"><a href="dectr.html#cb35-9"></a>lw1 &lt;-<span class="st"> </span><span class="kw">loess</span>(t_tau <span class="op">~</span><span class="st"> </span>p_tau,<span class="dt">data=</span>limited_data4_training,<span class="dt">span =</span> <span class="fl">0.1</span>)</span>
<span id="cb35-10"><a href="dectr.html#cb35-10"></a>cor1&lt;-<span class="kw">cor</span>(limited_data4_testing<span class="op">$</span>t_tau,<span class="kw">predict</span>(lw1,limited_data4_testing<span class="op">$</span>p_tau),<span class="dt">use =</span> <span class="st">&quot;p&quot;</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb35-11"><a href="dectr.html#cb35-11"></a></span>
<span id="cb35-12"><a href="dectr.html#cb35-12"></a>j &lt;-<span class="st"> </span><span class="kw">order</span>(limited_data4_training<span class="op">$</span>p_tau)</span>
<span id="cb35-13"><a href="dectr.html#cb35-13"></a><span class="kw">plot</span>(limited_data4_training<span class="op">$</span>p_tau,limited_data4_training<span class="op">$</span>t_tau,<span class="dt">xlab =</span> <span class="st">&quot;p-tau&quot;</span>,<span class="dt">ylab =</span> <span class="st">&quot;t-tau&quot;</span>,<span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;R2:&quot;</span>, <span class="kw">round</span>(cor1,<span class="dt">digits =</span> <span class="dv">2</span>)))</span>
<span id="cb35-14"><a href="dectr.html#cb35-14"></a></span>
<span id="cb35-15"><a href="dectr.html#cb35-15"></a><span class="kw">lines</span>(limited_data4_training<span class="op">$</span>p_tau[j],lw1<span class="op">$</span>fitted[j],<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span>
<span id="cb35-16"><a href="dectr.html#cb35-16"></a></span>
<span id="cb35-17"><a href="dectr.html#cb35-17"></a></span>
<span id="cb35-18"><a href="dectr.html#cb35-18"></a></span>
<span id="cb35-19"><a href="dectr.html#cb35-19"></a>lw1 &lt;-<span class="st"> </span><span class="kw">loess</span>(t_tau <span class="op">~</span><span class="st"> </span>p_tau,<span class="dt">data=</span>limited_data4_training,<span class="dt">span =</span> <span class="fl">0.6</span>)</span>
<span id="cb35-20"><a href="dectr.html#cb35-20"></a>cor2&lt;-<span class="kw">cor</span>(limited_data4_testing<span class="op">$</span>t_tau,<span class="kw">predict</span>(lw1,limited_data4_testing<span class="op">$</span>p_tau),<span class="dt">use =</span> <span class="st">&quot;p&quot;</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb35-21"><a href="dectr.html#cb35-21"></a><span class="kw">plot</span>(limited_data4_training<span class="op">$</span>p_tau,limited_data4_training<span class="op">$</span>t_tau,<span class="dt">xlab =</span> <span class="st">&quot;p-tau&quot;</span>,<span class="dt">ylab =</span> <span class="st">&quot;t-tau&quot;</span>,<span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;R2:&quot;</span>, <span class="kw">round</span>(cor2,<span class="dt">digits =</span> <span class="dv">2</span>)))</span>
<span id="cb35-22"><a href="dectr.html#cb35-22"></a>j &lt;-<span class="st"> </span><span class="kw">order</span>(limited_data4_training<span class="op">$</span>p_tau)</span>
<span id="cb35-23"><a href="dectr.html#cb35-23"></a><span class="kw">lines</span>(limited_data4_training<span class="op">$</span>p_tau[j],lw1<span class="op">$</span>fitted[j],<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups29"></span>
<img src="_main_files/figure-html/fig-groups29-1.png" alt="plot of p-tau vs t-tau using two models. The model on the left has span of 0.1 and the model on the right has the span of 0.6." width="1440" />
<p class="caption">
Figure 3.30: plot of p-tau vs t-tau using two models. The model on the left has span of 0.1 and the model on the right has the span of 0.6.
</p>
</div>
<p>It is clear that the flexible model on the left is following individual data point and lower <span class="math inline">\(R^2=0.55\)</span> whereas the restricted model on the right captures the pattern and get a better <span class="math inline">\(R^2=0.82\)</span>. Cross-validation can be used to figure out whether our model suffers from the sample problem or not.</p>
<p>The way that the cross-validation is performed is to randomly divide the dataset into several smaller subsets. They do the statistical modelling several times, each time, one subset is used as a validation set and the rest for training. Formally, we divide our dataset into <span class="math inline">\(k\)</span> different subsets and do the following</p>
<ol style="list-style-type: decimal">
<li>Take one subset of our data and keep it as the validation set.</li>
<li>Take the remaining <span class="math inline">\(k-1\)</span> subset and train the model on them</li>
<li>Take the validation set and measure the performance of the model</li>
<li>Repeat steps one to 3 but take another set as validation</li>
</ol>
<p>In the end, the error of the model is the average of all the errors from the cross-validation scheme.</p>
<p>Now the question is, how does this have to do with complexity parameters and decision trees?</p>
<p>The answer is, we can do cross-validation, and every time we build a new model calculate the complexity parameter, then pick the complexity parameter that both minimize the error of the model but also size of the tree. Let’s have a look and see how we can do it in practice. We keep a small part of the data outside of the modelling and will use it for testing later.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="dectr.html#cb36-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb36-2"><a href="dectr.html#cb36-2"></a><span class="kw">set.seed</span>(<span class="dv">50</span>)</span>
<span id="cb36-3"><a href="dectr.html#cb36-3"></a>testing_index&lt;-<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(limited_data),<span class="dv">20</span>,<span class="dt">replace =</span> F)</span>
<span id="cb36-4"><a href="dectr.html#cb36-4"></a>data2&lt;-limited_data[<span class="op">-</span>testing_index,]</span>
<span id="cb36-5"><a href="dectr.html#cb36-5"></a>data2<span class="op">$</span>group&lt;-<span class="kw">factor</span>(data2<span class="op">$</span>group)</span>
<span id="cb36-6"><a href="dectr.html#cb36-6"></a>data2<span class="op">$</span>gender&lt;-<span class="kw">factor</span>(data2<span class="op">$</span>gender)</span>
<span id="cb36-7"><a href="dectr.html#cb36-7"></a></span>
<span id="cb36-8"><a href="dectr.html#cb36-8"></a></span>
<span id="cb36-9"><a href="dectr.html#cb36-9"></a>tt&lt;-tree<span class="op">::</span><span class="kw">tree</span>(group<span class="op">~</span>abeta<span class="op">+</span>t_tau,<span class="dt">data=</span>data2,<span class="dt">split=</span><span class="st">&quot;gini&quot;</span>)</span>
<span id="cb36-10"><a href="dectr.html#cb36-10"></a><span class="kw">plot</span>(tt)</span>
<span id="cb36-11"><a href="dectr.html#cb36-11"></a><span class="kw">text</span>(tt,<span class="dt">pretty=</span><span class="dv">1</span>)</span>
<span id="cb36-12"><a href="dectr.html#cb36-12"></a></span>
<span id="cb36-13"><a href="dectr.html#cb36-13"></a><span class="kw">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb36-14"><a href="dectr.html#cb36-14"></a>cv_res =<span class="st"> </span>tree<span class="op">::</span><span class="kw">cv.tree</span>(tt, <span class="dt">FUN =</span> prune.misclass)</span>
<span id="cb36-15"><a href="dectr.html#cb36-15"></a></span>
<span id="cb36-16"><a href="dectr.html#cb36-16"></a><span class="kw">plot</span>(cv_res<span class="op">$</span>size, cv_res<span class="op">$</span>dev <span class="op">/</span><span class="st"> </span><span class="kw">nrow</span>(data2), <span class="dt">type =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb36-17"><a href="dectr.html#cb36-17"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Tree Size&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;CV Misclassification Rate&quot;</span>)</span>
<span id="cb36-18"><a href="dectr.html#cb36-18"></a><span class="kw">mtext</span>(<span class="st">&quot;complexity parameter&quot;</span>, <span class="dt">side =</span> <span class="dv">3</span>, <span class="dt">line =</span> <span class="dv">3</span>)     </span>
<span id="cb36-19"><a href="dectr.html#cb36-19"></a><span class="kw">axis</span>(<span class="dv">3</span>,<span class="dt">labels =</span> <span class="kw">round</span>(cv_res<span class="op">$</span>k,<span class="dv">2</span>),<span class="dt">at=</span>cv_res<span class="op">$</span>size, <span class="dt">cex.axis=</span><span class="fl">0.8</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups30"></span>
<img src="_main_files/figure-html/fig-groups30-1.png" alt="Cross validation on a tree build on the limited dataset" width="1440" />
<p class="caption">
Figure 3.31: Cross validation on a tree build on the limited dataset
</p>
</div>
<p>We see that our lowest missclassification error rate is coming from 0.25 leading to a tree with size 2. Let’s do the pruning:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="dectr.html#cb37-1"></a><span class="kw">library</span>(tree)</span>
<span id="cb37-2"><a href="dectr.html#cb37-2"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb37-3"><a href="dectr.html#cb37-3"></a></span>
<span id="cb37-4"><a href="dectr.html#cb37-4"></a>tt2&lt;-tree<span class="op">::</span><span class="kw">prune.misclass</span>(tt,<span class="dt">k=</span>cv_res<span class="op">$</span>k[<span class="kw">which.min</span>(cv_res<span class="op">$</span>dev)])</span>
<span id="cb37-5"><a href="dectr.html#cb37-5"></a><span class="kw">plot</span>(tt2)</span>
<span id="cb37-6"><a href="dectr.html#cb37-6"></a><span class="kw">text</span>(tt2,<span class="dt">pretty=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:fig-groups31"></span>
<img src="_main_files/figure-html/fig-groups31-1.png" alt="Pruned tree with the chosen complexity parameter" width="1440" />
<p class="caption">
Figure 3.32: Pruned tree with the chosen complexity parameter
</p>
</div>
<p>The original tree had an accuracy of 0.75 and the pruned tree has 0.75. Not that much different!? But the pruned tree is obviously more interpretable than the original one. This is what pruning does!</p>
<p>Similar methods that we discussed can be used for regression by changing the MSE to for example:</p>
<p><span class="math display">\[MSE_{\alpha}=\frac{1}{n}\sum_{i=1}^{n}{(y_i-\bar{y_i})^2}+\alpha.|\tilde{T}|\]</span>
We are now almost ready to go through bagging!</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bagging.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
